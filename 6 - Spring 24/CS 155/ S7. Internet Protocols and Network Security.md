---
Week: Week 7
---
# Layers of the internet

- Packets on the internet are sent with one header for each layer to unwrap

![[attachments/Untitled 74.png|Untitled 74.png]]

![[attachments/Untitled 1 41.png|Untitled 1 41.png]]

  

## Packet Encapsulation

![[attachments/Untitled 2 41.png|Untitled 2 41.png]]

  

# Ethernet layer

![[attachments/Untitled 3 41.png|Untitled 3 41.png]]

  

## Address Resolution Protocol (ARP)

![[attachments/Untitled 4 40.png|Untitled 4 40.png]]

![[attachments/Untitled 5 40.png|Untitled 5 40.png]]

![[attachments/Untitled 6 39.png|Untitled 6 39.png]]

  

### ARP Spoofing

![[attachments/Untitled 7 39.png|Untitled 7 39.png]]

![[attachments/Untitled 8 39.png|Untitled 8 39.png]]

  

# Internet layer

![[attachments/Untitled 9 38.png|Untitled 9 38.png]]

  

- The private IPv4 subnets mean that any address within these subnets cannot be referred to outside of the local network.

![[attachments/Untitled 10 37.png|Untitled 10 37.png]]

  

## IP Spoofing

- Defense:
    - Any packet coming from outside that contains a private IP address is blocked.
    - Zero trust → don’t give special privileges just because they’re in the private network.

![[attachments/Untitled 11 37.png|Untitled 11 37.png]]

  

## Network Address Translation (NAT)

- We’ve been talking about private IP addresses a lot. How does it work?

  

![[attachments/Untitled 12 37.png|Untitled 12 37.png]]

![[attachments/Untitled 13 36.png|Untitled 13 36.png]]

![[attachments/Untitled 14 34.png|Untitled 14 34.png]]

  

- Hosts in the private network will send messages outside.
    
    - The router will intercept that and act as a relay with the public IP.
    
    ![[attachments/Untitled 15 32.png|Untitled 15 32.png]]
    
    - The router rewrites the src IP address to its own IP address.
    
    ![[attachments/Untitled 16 32.png|Untitled 16 32.png]]
    
      
    
    - When the remove server responds, it replies to the router.
    
    ![[attachments/Untitled 17 29.png|Untitled 17 29.png]]
    
    - The router keeps track of which internal device initiated the connection.
        - It will rewrite the dst IP to get it back to the correct host.cs
    
    ![[attachments/Untitled 18 27.png|Untitled 18 27.png]]
    
      
    
    - There is a built in security benefit with NATs.
    
    ![[attachments/Untitled 19 24.png|Untitled 19 24.png]]
    
      
    

## Routing

![[attachments/Untitled 20 24.png|Untitled 20 24.png]]

![[attachments/Untitled 21 21.png|Untitled 21 21.png]]

  

- This is an example routing table.
    
    - Any IP that matches `10.10.188.0/24` is forwarded to `10.10.188.1`
    - Any IP that matches `192.168.0.0/16` is forwarded to `192.168.188.1`
    
    ![[attachments/Untitled 22 17.png|Untitled 22 17.png]]
    

  

![[attachments/Untitled 23 16.png|Untitled 23 16.png]]

![[attachments/Untitled 24 15.png|Untitled 24 15.png]]

![[attachments/Untitled 25 12.png|Untitled 25 12.png]]

![[attachments/Untitled 26 11.png|Untitled 26 11.png]]

  

### BGP hijacking

# Transport layer

  

## UDP

- Introduces the abstraction of ports (to get more applications from same host)

![[attachments/Untitled 27 10.png|Untitled 27 10.png]]

  

## TCP

- Introduces reliability and data streams.

![[attachments/Untitled 28 9.png|Untitled 28 9.png]]

![[attachments/Untitled 29 9.png|Untitled 29 9.png]]

![[attachments/Untitled 30 9.png|Untitled 30 9.png]]

![[attachments/Untitled 31 8.png|Untitled 31 8.png]]

![[attachments/Untitled 32 8.png|Untitled 32 8.png]]

  

  

  

### TCP Attacks

## TLS

![[attachments/Untitled 33 8.png|Untitled 33 8.png]]

![[attachments/Untitled 34 7.png|Untitled 34 7.png]]

  

### Asymmetric cryptography for TLS

![[attachments/Untitled 35 7.png|Untitled 35 7.png]]

  

- In practice (TLS), since asymmetric crytography is kind of slow, what they actually do is the Diffie-Hellman key exchange.
    
    - Server has a public and private key.
    - The client has a public and private key.
    - You use these keys to agree on a shared key that is used to encrypt all traffic.
    - They use this shared key to derive a symmetric cryptography key.
    - Once it has a symmetric key, it uses symmetric ciphers like AES (which are faster).
    
    ![[attachments/Untitled 36 6.png|Untitled 36 6.png]]
    

  

- To ensure that the keys are legit, we use certificates.
    
    ![[attachments/Untitled 37 6.png|Untitled 37 6.png]]
    
    ![[attachments/Untitled 38 6.png|Untitled 38 6.png]]
    

  

### Public key infrastructure (PKI) for TLS

![[attachments/Untitled 39 6.png|Untitled 39 6.png]]

![[attachments/Untitled 40 6.png|Untitled 40 6.png]]

  

### Establishing a TLS session

![[attachments/Untitled 41 5.png|Untitled 41 5.png]]

  

### TLS attacks and security issues

![[attachments/Untitled 42 5.png|Untitled 42 5.png]]

![[attachments/Untitled 43 5.png|Untitled 43 5.png]]

![[attachments/Untitled 44 5.png|Untitled 44 5.png]]

  

# Application Layer

- Below are a few common application protocols related to networking.

  

## Domain Name System (DNS)

![[attachments/Untitled 45 5.png|Untitled 45 5.png]]

![[attachments/Untitled 46 5.png|Untitled 46 5.png]]

![[attachments/Untitled 47 5.png|Untitled 47 5.png]]

  

### DNS architecture

![[attachments/Untitled 48 5.png|Untitled 48 5.png]]

![[attachments/Untitled 49 5.png|Untitled 49 5.png]]

![[attachments/Untitled 50 4.png|Untitled 50 4.png]]

- For example, if I want to connect to `cs155.stanford.edu`, and my local DNS server does not have records for this, I can use the authoritativive DNS server to look up.

  

### Well-known DNS servers

![[attachments/Untitled 51 3.png|Untitled 51 3.png]]

  

### DNS record types

![[attachments/Untitled 52 3.png|Untitled 52 3.png]]

![[attachments/Untitled 53 3.png|Untitled 53 3.png]]

![[attachments/Untitled 54 3.png|Untitled 54 3.png]]

- The NS tells me the next person who might know where the IP of `[sad.singles](http://sad.singles)` is.

  

### DNS hijacking

![[attachments/Untitled 55 3.png|Untitled 55 3.png]]

![[attachments/Untitled 56 3.png|Untitled 56 3.png]]

![[attachments/Untitled 57 3.png|Untitled 57 3.png]]

  

## HTTP

![[attachments/Untitled 58 3.png|Untitled 58 3.png]]

![[attachments/Untitled 59 3.png|Untitled 59 3.png]]

  

### HTTP/2

![[attachments/Untitled 60 3.png|Untitled 60 3.png]]

![[attachments/Untitled 61 3.png|Untitled 61 3.png]]

  

### HTTPS

![[attachments/Untitled 62 3.png|Untitled 62 3.png]]

![[attachments/Untitled 63 3.png|Untitled 63 3.png]]