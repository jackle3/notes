---
Week: Week 1
---
[https://static.us.edusercontent.com/files/4Mi0K911rRGaFsMgDpI3roOs](https://static.us.edusercontent.com/files/4Mi0K911rRGaFsMgDpI3roOs)

# Stack Frames

- %rsp, %rbp, etc — 64 bit/8 byte CPU registers

![[attachments/Untitled 84.png|Untitled 84.png]]

- Frames get added in direction of lower addresses → stack grows down.
    - When a function is called, a stack frame is added.
    - When a function returns, the stack frame gets “popped” off.
- RBP = base pointer (points to previous frame’s base pointer → callee’s base pointer)
    - Local variables are often accessed relative to RBP.
    - “base” of the stack space a function has to work with.
- RSP = stack pointer (points to lowest address in the stack)
- args = parameters to function
- Return address = memory address of instruction to return to after this function finishes.

![[attachments/Untitled 1 51.png|Untitled 1 51.png]]

# Adding frame

- Notice that the RBP of `main` is saved in the stack frame of the lower function.

![[attachments/Untitled 2 51.png|Untitled 2 51.png]]

![[attachments/Untitled 3 51.png|Untitled 3 51.png]]

![[attachments/Untitled 4 50.png|Untitled 4 50.png]]

# Removing frame

![[attachments/Untitled 5 50.png|Untitled 5 50.png]]

![[attachments/Untitled 6 49.png|Untitled 6 49.png]]

![[attachments/Untitled 7 49.png|Untitled 7 49.png]]

![[attachments/Untitled 8 49.png|Untitled 8 49.png]]

# Buffer overflow

![[attachments/Untitled 9 48.png|Untitled 9 48.png]]

- `strcpy` is vulnerable because it can copy unlimited → easy to overflow past buffer.# xpl

# Other attacks

![[attachments/Untitled 10 47.png|Untitled 10 47.png]]

# xploit1

![[attachments/Untitled 11 47.png|Untitled 11 47.png]]

- Note that we are overflowing the buffer in `foo`, since that is where `buf` is created.

![[attachments/Untitled 12 47.png|Untitled 12 47.png]]

- The buffer is 256. We want to overwrite the buffer and the RA and the RBP.
    - As such, the exploit needs to be 256 + 8 + 8 = 272.
- We want the address of the buffer to be the new RA.
    - Go into GDB and print out the address of the buffer.

# Hints

![[attachments/Untitled 13 45.png|Untitled 13 45.png]]

![[attachments/Untitled 14 43.png|Untitled 14 43.png]]

![[attachments/Untitled 15 41.png|Untitled 15 41.png]]