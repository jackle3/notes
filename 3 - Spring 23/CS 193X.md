## 4/4 L1: HTML

* This class ==does not== count towards the undergrad program sheet.

### Topic outline

1. **Client-side JavaScript (3 weeks)**

   Syntax, data structures, page interactions, events

2. **Web page layout: HTML and CSS (1.5 weeks)**

   APIs, dynamic content

3. **APIs and server-side JavaScript (2.5 weeks)**

   fetch, async/await Creating an API Data storage with MongoDB

4. **Full stack topics (2 weeks)**

   Mobile and accessible design User authentication

### The Internet

#### URL

* When you type a URL in a browser it
  1. Finds the server that has the web page
  2. Ask for the server for the page
  3. Displays the page

#### Servers and Ports

* How to know which program a request belongs to:
  1. Each program listens on a **port** (a number)
  2. Client says which port it wants to talk to
  3. There are standard ports for web, mail, etc
  4. Can use custom ports for unusual services, internal use only, etc

#### Protocol

* A set of messages written in a standard.
* Any program that "speaks" a protocol can communicate with any other.

![image-20230404155125462](attachments/cs193x.assets/image-20230404155125462.png)

* The command `GET / HTTP/1.1` is the protocol; it's a web request under the HTTP protocol.

### HTML

* When you open a file, first do `npm install` then `npm start`.

#### Tags

* HTML is structured as a tree, where each tag is a node.
  * Nodes are called elements. It can have a parent and children, and can contain text.
  * Indentation is used to show the inside levels of the tree.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Our first web page</title>

    <!-- These two lines provide automatic page and style reloading when files change -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/lib/client/updater.js" defer></script>
  </head>
  <body>
    This is my first web page!
  </body>
</html>
```

* In the above, the `html` element is the outermost node.

#### Formatting

* You can change the size of the text using headings. The text below would be much bigger on the page because its in a heading 1.

  ```html
  <h1>This is my first web page!</h1>
  ```

* The code below generates the webpage shown below.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Our first web page</title>

    <!-- These two lines provide automatic page and style reloading when files change -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/lib/client/updater.js" defer></script>
  </head>
  <body>
    <h1>This is my first web page!</h1>
    <p>Isn't this exciting??</p>
  </body>
</html>
```

![image-20230404161018716](attachments/cs193x.assets/image-20230404161018716.png)

* HTML won't error check. If we forget to close a tag, it simply treats the next tag as part of the unclosed tag.

```html
<h1>This is my first web page!
<p>Isn't this exciting??</p>
Hello</h1>
<p>potato</p>
```

![image-20230404161115978](attachments/cs193x.assets/image-20230404161115978.png)

#### Links and Buttons

* You can put links into your webpages as follows:

```html
<a href="https://www.google.com">Google</a>
```

* You can put buttons like this:

```html
<button>Test</button>
```

---

## 4/6 L2: JavaScript

### HTML Takeaways

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Our first web page</title>
    <!-- Automatic reloading when files change -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/lib/client/updater.js" defer></script>
  </head>
  <body>
    <h1>Hello, world!</h1>
    <p>This is our first web page.</p>
    <a href="https://cs193x.stanford.edu">Course page</a><br>
    <a href="hello.txt">Text file</a>
  </body>
</html>
```

<img src="./cs193x.assets/image-20230406152033218.png" alt="image-20230406152033218" style="zoom:50%;" />

#### tags

* Each set of tags has a start tag and an end tag.
* Note that not everything in the HTML file will show in the final website.
* A node is a set of tags: `<body> ... <\body>`
* The `<br>` is a line break, it is now we get a new line.
  * It's a leaf node of the tree. It has no children, so it doesn't have a closing tag.
  * For most other nodes, it should have an opening tag and a closing tag, even if there is no children (content) inside the node.

#### head

* Contains information about the page, it's not displayed
* `<meta>`: page metadata (author, search engine keywords, character set, etc)
* `<title>`: title shown in the tab/taskbar of the browser
* `<script>` and `<link>`: refer to other files

#### body

* Contains the page contents
* It has a few elements:
  * `<h1>, <h2>, ..., <h6>`: heading
  * `<p>`: paragraph
  * `<a href="...">`: link

#### other

* Front end is the client-facing side
* Back end is the things in the back, how the website works and how it communicates.

### JavaScript

* You can have integers, strings, etc.
* You can add strings to integers: `193 + "x"` makes `"193x"`
* Semicolons are not always necessary. If they aren't there, it will likely interpret the new line as that.
  * However, it is best practice to just always use semicolons.

#### Variables

* You can make variables using `let`.

<img src="./cs193x.assets/image-20230406154721903.png" alt="image-20230406154721903" style="zoom:50%;" />

* Undefined just basically means that previous line didn't return anything.

* Variables are not typed. If you add a string to a number, that variable becomes a string.

<img src="./cs193x.assets/image-20230406154753442.png" alt="image-20230406154753442" style="zoom:50%;" />

* You can make constant variables using the `const`.

<img src="./cs193x.assets/image-20230406154935100.png" alt="image-20230406154935100" style="zoom:50%;" />

* If we reference a variable that was never created, it will error.

<img src="./cs193x.assets/image-20230406155334114.png" alt="image-20230406155334114" style="zoom:50%;" />

* If we use neither `let` nor `const`, the variable will be a global variable. ==It is suggested to never do this.==

<img src="./cs193x.assets/image-20230406155408457.png" alt="image-20230406155408457" style="zoom:50%;" />

```js
let x = 42; // -- define and initialize x
let x; // -- define x, no initial value (undefined)
const x = 42; // -- value of x can't change (must assign value)
```

#### Printing

* To print to the console, use `console.log`

<img src="./cs193x.assets/image-20230406154839153.png" alt="image-20230406154839153" style="zoom:50%;" />

* Again, `console.log` doesn't return anything, hence why it shows undefined.
* You can also just put elements in commas to have them separated by space.

<img src="./cs193x.assets/image-20230406155952231.png" alt="image-20230406155952231" style="zoom:50%;" />

#### If-statements

* If-statements are very much like C++.

<img src="./cs193x.assets/image-20230406155021174.png" alt="image-20230406155021174" style="zoom:50%;" />

#### For-loops

* For-loops are also very much like C++. Similar to that as well, you don't always need the semicolons.

<img src="./cs193x.assets/image-20230406155107868.png" alt="image-20230406155107868" style="zoom:50%;" />

#### Null

* Note that undefined and null mean two different things.

<img src="./cs193x.assets/image-20230406155142656.png" alt="image-20230406155142656" style="zoom:50%;" />

* Null is intentional. It basically means there is nothing here.
* Undefined means that something wasn't given. It's not the same as null.

#### Equality

* Don't use `==`. If you use `==` in JS, it will convert the type, which can lead to issues.

<img src="./cs193x.assets/image-20230406155604607.png" alt="image-20230406155604607" style="zoom:50%;" />

* In the above, `"0"` gets converted into the number `0`, which is equal to `false`.
  * Note that this only applies to `==`.

* You should use `===`.

<img src="./cs193x.assets/image-20230406155706905.png" alt="image-20230406155706905" style="zoom:50%;" />

* Exception: `x == null` tests if `x` is null or undefined.

#### Functions

* Functions are basically just another kind of variable.

```js
const name = (arg1, arg2) => {
    /* ... */
    return ...;
}
```



* You should define functions using `const`, since you probably don't want to redefine the function.

<img src="./cs193x.assets/image-20230406160009704.png" alt="image-20230406160009704" style="zoom:50%;" />

<img src="./cs193x.assets/image-20230406160053820.png" alt="image-20230406160053820" style="zoom:50%;" />

<img src="./cs193x.assets/image-20230406160113269.png" alt="image-20230406160113269" style="zoom:50%;" />

* The `(x, y)` is our parameters. Note that they are not typed.
* Then, we have the thick arrow / equal arrow `=>`.
* Our function body then goes in the curly braces.

#### Full file

```js
let str = "Hello";
let x = 42;
if (x < 193) {
    str += ", world!";
    x = x * 2;
} else {
    str += ", CS193X!";
}
console.log(str);
console.log(x);
```

### JS Types

* Boolean: true or false
* Number: both integer and floating point
  * All numbers are double
  * See Math for some useful functions on numbers
* String: immutable
  * Single or double quotes equivalent, be consistent
  * length property (not method)
* null: "intentionally absent" value
* undefined: no value
  * return; (or no return statement)
  * Variable without assigned value

### JS in browser

* We can include JavaScript in an HTML file as follows. Note that the main line is the `hello.js` line.

```html
<!-- This file is index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Our first web page</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/lib/client/updater.js" defer></script>

    <script type="module" src="hello.js"></script> <!--HERE-->
  </head>
  <body>
    <h1>Hello, world!</h1>
    <p>This is our first web page.</p>
    <a href="https://cs193x.stanford.edu">Course webpage</a><br>
    <a href="hello.txt">Text file</a>
  </body>
</html>

```

```js
// This is the code contained in the hello.js
const add = (a, b) => {
    console.log("Adding", a, "and", b);
    return a + b;
};

const main = () => {
    console.log(add(193, "X"));
};
main();
```

* With the above, every time we load the page, the following shows in the console.

![image-20230406161405371](attachments/cs193x.assets/image-20230406161405371.png)

* The "Navigated to" stuff appears because I reloaded the page multiple times.
* If we have multiple function calls, it shows all three of them.

```js
// for example this was the bottom of the js file above.
const main = () => {
    console.log(add(193, "X"));
};
main();
main();
main();
```

![image-20230406161522431](attachments/cs193x.assets/image-20230406161522431.png)

### Debugging

* Go to the Sources tab in the developer window of the browser.

![image-20230406161623855](attachments/cs193x.assets/image-20230406161623855.png)

* You can put a breakpoint by clicking the empty part next to the line number.

![image-20230406161722504](attachments/cs193x.assets/image-20230406161722504.png)

* You can hover over a variable to see its value. You can also look at the Scope section on the right to see all the variables in each scope.

![image-20230406161834051](attachments/cs193x.assets/image-20230406161834051.png)

* We can step into, step next, etc by clicking the buttons on the top right.

---

## 4/11 L3: ADTs and Classes

### Arrays

* You can instantiate arrays using `let`.

![image-20230411151535254](attachments/cs193x.assets/image-20230411151535254.png)

* You can access elements using the square brackets, with zero index.

![image-20230411152254745](attachments/cs193x.assets/image-20230411152254745.png)

#### Push

* You can add to an array using the push function.

![image-20230411151607989](attachments/cs193x.assets/image-20230411151607989.png)

* Push takes multiple arguments, so you can add multiple things.

#### Index

* You can find the index of an element using indexOf

![image-20230411151639722](attachments/cs193x.assets/image-20230411151639722.png)

#### Insert / Delete

* You delete elements using splice.

![image-20230411151722135](attachments/cs193x.assets/image-20230411151722135.png)

* Note that `delete` on an array is not the same as splice.
  * You shouldn't generally use `delete`.

![image-20230411152539475](attachments/cs193x.assets/image-20230411152539475.png)

* Since arrays are basically objects, it just simply removes that key. The space is still left there.

#### Slice

* You can take sublists using slicing

![image-20230411151936976](attachments/cs193x.assets/image-20230411151936976.png)

#### For Loops

* You can loop through an array in two ways.

![image-20230411151513958](attachments/cs193x.assets/image-20230411151513958.png)

* Note that the `for ... of` is different from `for ... in`

#### Summary

![image-20230411153342070](attachments/cs193x.assets/image-20230411153342070.png)

![image-20230411153345760](attachments/cs193x.assets/image-20230411153345760.png)

### Objects

* Objects are a key-value storage, like a map.
  * Keys must be strings, values can be anything
    * If the key has multiple words, it needs to be quoted

![image-20230411152211293](attachments/cs193x.assets/image-20230411152211293.png)

* Note that arrays are a type of object.

#### Accessing

* You can access the values of objects using either the square brackets or just using a dot.
  * If you can use the dot to access a key, you should use it.

![image-20230411152344451](attachments/cs193x.assets/image-20230411152344451.png)

* It will return undefined if the object doesn't exist.

![image-20230411153031659](attachments/cs193x.assets/image-20230411153031659.png)

#### Delete

* You can delete object keys using `delete`.

![image-20230411152643158](attachments/cs193x.assets/image-20230411152643158.png)

#### Contains

* We can check if a key is in an object using the `in` keyword

![image-20230411152849253](attachments/cs193x.assets/image-20230411152849253.png)

* You can use the fact that undefined is returned if it doesn't exist to do stuff.

![image-20230411153135601](attachments/cs193x.assets/image-20230411153135601.png)

#### Iteration

* We can get the values, keys, and entries from the object as follows

![image-20230411153253514](attachments/cs193x.assets/image-20230411153253514.png)

* `Object.entries` returns an array containing arrays of length 2 of `[key, value]`

* We can loop through all the values and keys of the object.

![image-20230411153712061](attachments/cs193x.assets/image-20230411153712061.png)

* We can also loop through the entry (key-value pair)

![image-20230411153739246](attachments/cs193x.assets/image-20230411153739246.png)

* We can use string formatting to make this prettier. This is like f-strings in Python.

![image-20230411153904536](attachments/cs193x.assets/image-20230411153904536.png)

* Note that in the above, we can also add an array to an object.

#### References

* Note that arrays and objects are mutable, so they can be changed by functions.
* Variables and arguments store references.

![image-20230411154025261](attachments/cs193x.assets/image-20230411154025261.png)	

#### Summary

![image-20230411153434636](attachments/cs193x.assets/image-20230411153434636.png)

![image-20230411153437786](attachments/cs193x.assets/image-20230411153437786.png)

![image-20230411153441696](attachments/cs193x.assets/image-20230411153441696.png)

![image-20230411153445744](attachments/cs193x.assets/image-20230411153445744.png)

![image-20230411153453162](attachments/cs193x.assets/image-20230411153453162.png)

![image-20230411154037636](attachments/cs193x.assets/image-20230411154037636.png)

### Useful Language Features

#### Destructuring

* You can assign an array or object to multiple variables to contain its values.

![image-20230411154208443](attachments/cs193x.assets/image-20230411154208443.png)

* This also works with objects. However, the variable names matter.

![image-20230411154316492](attachments/cs193x.assets/image-20230411154316492.png)

![image-20230411154324614](attachments/cs193x.assets/image-20230411154324614.png)

### JavaScript

```html
// this file is index.html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Lecture 3</title>

    <script type="module" src="/lib/client/updater.js"></script>

    <!-- This is how we include other JS files and run them -->
    <script type="module" src="index.js"></script>
  </head>
  <body>
    <h1>Lecture 3</h1>
  </body>
</html>

```

```js
// this file is index.js
const add = (a, b) => {
  console.log("Adding", a, "and", b);
  return a + b;
};

const main = () => {
  console.log(add(193, "X"));
};
main();
```

* When we load the page above, this is shown in the console.

![image-20230411154559418](attachments/cs193x.assets/image-20230411154559418.png)

* Note that the user does not have access to these functions in the console.

![image-20230411154633880](attachments/cs193x.assets/image-20230411154633880.png)

* To give the user access, we use the keyword `window` in the javascript file.

```js
const add = (a, b) => {
  console.log("Adding", a, "and", b);
  return a + b;
};
// Expose add to the console
window.add = add

const main = () => {
  console.log(add(193, "X"));
};
main();
```

![image-20230411154732603](attachments/cs193x.assets/image-20230411154732603.png)

* Notice that now, you can use the function in the console.

### Debugger

* We can directly put the command `debugger;` in a file to go into the debugger right where the statement is when the page is loaded.

```js
const add = (a, b) => {
  debugger;
  console.log("Adding", a, "and", b);
  return a + b;
};
// Expose add to the console
window.add = add

const main = () => {
  // console.log(add(193, "X"));
};
main();
```

* Note that `debugger` line above. Now if we load the page and call `add`, we get thrown into the debugger.

![image-20230411154948474](attachments/cs193x.assets/image-20230411154948474.png)

![image-20230411154958233](attachments/cs193x.assets/image-20230411154958233.png)

### Export and Import

* Suppose we want to move our `add` function from before into a new file.

```js
// this code is for app.js
const add = (a, b) => {
    debugger;
    console.log("Adding", a, "and", b);
    return a + b;
};

// Expose add to the console
window.add = add
// Export the add function to allow other files to use it
export default add;
```

* We use export in the original file to allow other files to use the function

```js
// this code is in index.js
import add from "./add.js";

const main = () => {
  // console.log(add(193, "X"));
};
main();
```

![image-20230411155421283](attachments/cs193x.assets/image-20230411155421283.png)

* The output on the website is the same as before now.
* You can also export and import variables.
* The syntax below is for named exports.

```js
// app.js
const add = (a, b) => {
    console.log("Adding", a, "and", b);
    return a + b;
};

// Expose add to the console
window.add = add
// Export the add function to allow other files to use it
export default add;
// Export a variable
export const myVariable = 13414;
```

```js
// index.js
import add from "./add.js";
import { myVariable } from "./add.js";

const main = () => {
  console.log(add(193, "X"));
  console.log(myVariable);
};
main();
```

![image-20230411155649770](attachments/cs193x.assets/image-20230411155649770.png)

* You can only have one `export default` in a whole file. This is the one that you don't put inside the curly braces when you import.
  * The rest will just be `export`, and they must be surrounded by curly braces when you import.

#### Summary

![image-20230411155431030](attachments/cs193x.assets/image-20230411155431030.png)

![image-20230411155436850](attachments/cs193x.assets/image-20230411155436850.png)

![image-20230411155743090](attachments/cs193x.assets/image-20230411155743090.png)

### Classes

* We can also create classes in JS.
* Classes have a constructor, methods, and instance variables (fields)
* The example class below represents a point, keeping track of an `x` and `y` position.
* Note that instance variables don't need to be declared ahead of time. They can be declared in the constructor.

```js
// this is in a file called classes.js
// export default is so that other files can use this class
export default class Point {
    // constructor
    constructor(x, y) {
        // instance variables
        this._x = x;
        this._y = y;
    }
    // methods
    move(dx, dy) {
        this._x += dx;
        this._y += dy;
    }
}
// Expose the point class to the console
window.Point = Point;
```

```js
// This is in the index.js file
import add from "./add.js";
import { myVariable } from "./add.js";
import Point from "./classes.js"

const main = () => {
  console.log(add(193, "X"));
  console.log(myVariable);
};
main();
```

* To create a class in the console, we can do it as follows.

![image-20230411160400646](attachments/cs193x.assets/image-20230411160400646.png)

* The convention is to name a variable with _ for private members (e.g. `this._privateVar`).
  * Note that this variable is not actually private. The console can still access it. It is just convention to not access anything starting with _.

```js
// export default is used so that other files can use this class
export default class Point {
    // constructor
    constructor(x, y) {
        // instance variables
        this._x = x;
        this._y = y;
        this._privateVar = 42;
    }
    // methods
    move(dx, dy) {
        this._x += dx;
        this._y += dy;
    }
}
// Expose the point class to the console
window.Point = Point;
```

![image-20230411160551850](attachments/cs193x.assets/image-20230411160551850.png)

#### More Methods

* A common method is toString, which returns a string representation.
* It is automatically called when the object is added to a string.

```js
// export default is used so that other files can use this class
export default class Point {
    // constructor
    constructor(x, y) {
        // instance variables
        this._x = x;
        this._y = y;
        this._privateVar = 42;
    }
    // methods
    move(dx, dy) {
        this._x += dx;
        this._y += dy;
    }
    // toString method
    toString() {
        return `(${this._x}, ${this.y})`;
    }
}
// Expose the point class to the console
window.Point = Point;
```

![image-20230411160730829](attachments/cs193x.assets/image-20230411160730829.png)

#### Another Class

* This time we make a `Rect` class for rectangles.

```js
export class Rect {
    constructor(topLeft, width, height) {
        this._topLeft = topLeft;
        this._width = width;
        this._height = height;
    }
}
// Expose the rect class to the console
window.Rect = Rect;
```

* We can pass other classes in as arguments. In this case, we pass a Point as the topLeft.

![image-20230411161105608](attachments/cs193x.assets/image-20230411161105608.png)

![image-20230411161115747](attachments/cs193x.assets/image-20230411161115747.png)

* Notice that it's a nested class.

#### Summary

![image-20230411161205121](attachments/cs193x.assets/image-20230411161205121.png)

![image-20230411160408931](attachments/cs193x.assets/image-20230411160408931.png)

![image-20230411160418129](attachments/cs193x.assets/image-20230411160418129.png)

### Exceptions

* You can make exceptions use a try/catch block

![image-20230411161946343](attachments/cs193x.assets/image-20230411161946343.png)

![image-20230411161950141](attachments/cs193x.assets/image-20230411161950141.png)

### Summary

* This is the final code file for everything.

```js
// export default is used so that other files can use this class
export class Point {
    // constructor
    constructor(x, y) {
        // instance variables
        this._x = x;
        this._y = y;
    }
    // methods
    move(dx, dy) {
        this._x += dx;
        this._y += dy;
    }
    // toString method
    toString() {
        return `(${this._x}, ${this._y})`;
    }
}
// Expose the point class to the console
window.Point = Point;

export class Rect {
    // constructor, topLeft will be a Point class object
    constructor(topLeft, width, height) {
        this._topLeft = topLeft;
        this._width = width;
        this._height = height;
    }
    // toString method
    toString() {
        return this._topLeft + ` [width is ${this._width}, height is ${this._height}]`;
    }
}
// Expose the rect class to the console
window.Rect = Rect;
```

```js
// This is index.js
import add from "./add.js";
import { myVariable } from "./add.js";
import { Point, Rect } from "./classes.js"

const main = () => {
  console.log(add(193, "X"));
  console.log(myVariable);
  let p = new Point(5, 10);
  let r = new Rect(p, 10, 20);
  console.log("p " + p);
  console.log("r " + r);
};
main();
```

```js
// This is add.js
const add = (a, b) => {
    console.log("Adding", a, "and", b);
    return a + b;
};

// Expose add to the console
window.add = add
// Export the add function to allow other files to use it
export default add;
// Export a variable
export const myVariable = 13414;
```

![image-20230411161811809](attachments/cs193x.assets/image-20230411161811809.png)

* This is the console output of all the code.

---

## 4/13 L4: DOM, buttons, inputs, and events

### Document Object Model (DOM)

![image-20230413150801709](attachments/cs193x.assets/image-20230413150801709.png)

* To interact with the page itself, we can refer to the document object.

![image-20230413151324640](attachments/cs193x.assets/image-20230413151324640.png)

* The `document.head` and `document.body` has children. You can access them.

![image-20230413151413872](attachments/cs193x.assets/image-20230413151413872.png)

* The children can also access its parent.

![image-20230413151509167](attachments/cs193x.assets/image-20230413151509167.png)

* The children in the tree can also go to another element under the same parent.

![image-20230413151547732](attachments/cs193x.assets/image-20230413151547732.png)

* ==An element is a type of node,== but nodes are not necessarily elements.

#### Element stuff

* You can access the text of an element and change it.

![image-20230413151827612](attachments/cs193x.assets/image-20230413151827612.png)

* You can refer to fields in a nested manner.

![image-20230413151917178](attachments/cs193x.assets/image-20230413151917178.png)

* You can edit these fields as well.

![image-20230413151951451](attachments/cs193x.assets/image-20230413151951451.png)

#### Giving elements an ID

* You can give elements an ID to refer to it easier. We edit this in the html.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>DOM and Events | Lecture 4</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="events.js"></script>
  </head>
  <body>
    <h1>DOM and Events</h1>
    <p>A paragraph with a <a href="https://cs193x.stanford.edu">link</a> inside.</p>

  </body>
</html>
```

* The code above is the original file of events.html.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>DOM and Events | Lecture 4</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="events.js"></script>
  </head>
  <body>
    <h1>DOM and Events</h1>
    <p id="para">A paragraph with a <a href="https://cs193x.stanford.edu">link</a> inside.</p>

  </body>
</html>
```

* In the code above, we gave the paragraph the id of para. Using this, we can now easily access it without finding the index.

![image-20230413152158652](attachments/cs193x.assets/image-20230413152158652.png)

### Adding/removing elements

* We can create an element as follows.

![image-20230413152419071](attachments/cs193x.assets/image-20230413152419071.png)

* We can add this element to our page as follows.

![image-20230413152438091](attachments/cs193x.assets/image-20230413152438091.png)

* We can also remove this element as follows.

![image-20230413152454076](attachments/cs193x.assets/image-20230413152454076.png)

#### Summary

![image-20230413151656664](attachments/cs193x.assets/image-20230413151656664.png)

![image-20230413151701719](attachments/cs193x.assets/image-20230413151701719.png)

![image-20230413151707411](attachments/cs193x.assets/image-20230413151707411.png)

### Events in HTML (with text)

* Suppose we add the clickme paragraph into our HTML as follows.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>DOM and Events | Lecture 4</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="events.js"></script>
  </head>
  <body>
    <h1>DOM and Events</h1>
    <p id="para">A paragraph with a <a href="https://cs193x.stanford.edu">link</a> inside.</p>
    <p id="clickme">Click me!</p>
  </body>
</html>
```

![image-20230413152650075](attachments/cs193x.assets/image-20230413152650075.png)

* We want the page to do something when the user clicks on this paragraph. To do so, we do the following on the console.

![image-20230413152926006](attachments/cs193x.assets/image-20230413152926006.png)

* Now, when we click on the text `Click me!`, we get this alert.

![image-20230413152940889](attachments/cs193x.assets/image-20230413152940889.png)

#### Summary

![image-20230413153301168](attachments/cs193x.assets/image-20230413153301168.png)

### HTML Interactors and Forms

#### Interactors

![image-20230413154838701](attachments/cs193x.assets/image-20230413154838701.png)

#### Forms

![image-20230413154845292](attachments/cs193x.assets/image-20230413154845292.png)

### Buttons and Events

* We can use the button element type to create a clickable button.
* We put the following code in the `events.html` file.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>DOM and Events | Lecture 4</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="events.js"></script>
  </head>
  <body>
    <h1>DOM and Events</h1>
    <!-- This is the form for the button below -->
    <form id="clickcount">
      <button id="clickme">Click me!</button>
    </form>
  </body>
</html>
```

* Now we do the `events.js` file.

```js
let nClicks = 0;
const main = () => {
  // create an event handler for the button from events.html
  let form = document.forms.clickcount; // access the forms in the document
  let button = form.clickme;
  // you can nest functions
  const handleClick = () => {
    nClicks++;
    button.textContent = `Clicked ${nClicks} times`;
  };
  // add event listener to button
  button.addEventListener("click", handleClick);
};
main();
```

* When we have a form, and a button inside the form, the default behavior of the button is as a submit button for the form.

  * Therefore, when we click the button, it will refresh the page.

    ![image-20230413154717479](attachments/cs193x.assets/image-20230413154717479.png)

    * That is why we see this error.

* To fix this, we change the code to

```html
<button type="button" id="clickme">Click me!</button>
```

* Now the code works and the button persists.

![image-20230413154817423](attachments/cs193x.assets/image-20230413154817423.png)

* We can also make **another button**.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>DOM and Events | Lecture 4</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="events.js"></script>
  </head>
  <body>
    <h1>DOM and Events</h1>
    <form id="clickcount">
      <button type="button" id="clickme">Click me!</button>
      <button type="button" id="unclickme">Unclick me!</button>
    </form>
  </body>
</html>
```

* For our uses, `clickme` increments the counter on the button, then `unclickme` decrements the counter.

* We now also have to change our `events.js` file to as follows.
  * We give our event function an argument so that we can use the same `handleClick` function for both buttons.
    * We use the `event` argument, which comes from the browser.
    * `event` has a few special properties.

```js
let nClicks = 0;
const main = () => {
  // create an event handler for the button from events.html
  let form = document.forms.clickcount; // access the forms in the document
  let clickme = form.clickme;   // refer to the clickme button
  let unclickme = form.unclickme;   // refer to the unclickme button
  // you can nest functions
  const handleClick = (event) => {
    // currentTarget is the HTML element that was clicked and called the event listener
    let whichButton = event.currentTarget;  // stores either clickme or unclickme

    /// there's multiple ways to compare the button
    // if (whichButton === clickme) nClicks++;
    // else nClicks--;
    if (whichButton.id === "clickme") nClicks++;
    else nClicks--;
    
    clickme.textContent = `Clicked ${nClicks} times`;
  };
  // add event listener to buttons
  clickme.addEventListener("click", handleClick);
  unclickme.addEventListener("click", handleClick);
};
main();
```

![image-20230413155659420](attachments/cs193x.assets/image-20230413155659420.png)

* Now, every time we click the left button the number goes up. When you click the right button, the number goes down.

#### Events Summary

![image-20230413160204466](attachments/cs193x.assets/image-20230413160204466.png)

![image-20230413160208744](attachments/cs193x.assets/image-20230413160208744.png)

![image-20230413160217398](attachments/cs193x.assets/image-20230413160217398.png)

### Events and classes

![image-20230413160237824](attachments/cs193x.assets/image-20230413160237824.png)

![image-20230413160241310](attachments/cs193x.assets/image-20230413160241310.png)

![image-20230413160245937](attachments/cs193x.assets/image-20230413160245937.png)

![image-20230413160250194](attachments/cs193x.assets/image-20230413160250194.png)

#### Style Tips

![image-20230413160311954](attachments/cs193x.assets/image-20230413160311954.png)

### Unit Converter

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Unit Converter | Lecture 4</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="converter.js"></script>
  </head>
  <body>
    <h1>Unit Converter</h1>
    <form id="converter">
      <label>US customary: <input type="number" id="us"></label><br>
      <label>Metric: <input type="number" id="metric"></label><br>
      <button id="convert">in. &rarr; cm</button>
    </form>
  </body>
</html>
```

* This is the HTML code for `converter.html`. This is what shows on the screen.
* Note that `&rarr` is how the right arrow is shown on the button.

![image-20230413160415036](attachments/cs193x.assets/image-20230413160415036.png)

* The `input` tags are how we get text input from the user. Notice that we wrap each of these in labels.
  * The label may not always change how the page looks. However, it makes it so that you can click on the text to access the text box.
    * Without the label, nothing happens when you click the text. You have to click the box to actually type.
    * It labels the text (e.g. `Metric`) to the text input box.
  * There's two ways to use the label.
    * `<label>Metric: <input type="number" id="metric"></label><br>`
      * This wraps the entire input and text in a label.
    * `<label for="metric">Metric:</label> <input type="number" id="metric"><br>`
      * This assigns the label to the input box with a certain id.

* **Note:** Classes that interacts a lot with DOM and the user experience are called components. Classes that work with just data are called models.

```js
// we will be working with DOM a lot for this
export default class Converter {
  constructor() {
    // create a private instance variable for our form
    this._form = document.forms.converter;

    // add an event listener to our button
    this._form.convert.addEventListener("click", this._handleClick);
  }

  // create the method to handle our click
  _handleClick(event) {
    console.log("Click!");
  }
}

let app = new Converter();
window.app = app;
```

* The code above is a starting point. The `console.log` is used to debug to make sure our button actually works.

![image-20230413161357493](attachments/cs193x.assets/image-20230413161357493.png)

* Aside: error messages

![image-20230413161626438](attachments/cs193x.assets/image-20230413161626438.png)

* The line in question for the above error is `let usValue = this._form.us.valueAsNumber;`
* This means that `this._form` is undefined, since the `us` is trying to be read.

#### Final code

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Unit Converter | Lecture 4</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="converter.js"></script>
  </head>
  <body>
    <h1>Unit Converter</h1>
    <form id="converter">
      <label>US customary: <input type="number" id="us"></label><br>
      <label>Metric: <input type="number" id="metric"></label><br>
      <button type="button" id="convert">in. &rarr; cm</button>
    </form>
  </body>
</html>
```

```js
// we will be working with DOM a lot for this
export default class Converter {
  constructor() {
    // create a private instance variable for our form
    this._form = document.forms.converter;

    // when the browser calls _handleClick, the function is not exactly from this function
    //  this makes it so the variable we used is the class itself
    this._handleClick = this._handleClick.bind(this);

    // *** always bind event handlers in your constructors ***

    // add an event listener to our button
    this._form.convert.addEventListener("click", this._handleClick);
  }

  // create the method to handle our click
  _handleClick(event) {
    // we can use .value to get the value of the input box
    /// let usValue = this._form.us.value;
    //    .value will return a string, so we need it to be a number
    let usValue = this._form.us.valueAsNumber;
    this._form.metric.value = usValue * 2.54;
  }
}

let app = new Converter();
window.app = app;
```

---

## 4/18 L5: More DOM and events

### HTML forms

![image-20230418150842983](attachments/cs193x.assets/image-20230418150842983.png)

### Event default behavior

![image-20230418150919942](attachments/cs193x.assets/image-20230418150919942.png)

### Event bubbling

![image-20230418150926628](attachments/cs193x.assets/image-20230418150926628.png)

### To Do List

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Dynamic List | Lecture 5</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="list.js"></script>
  </head>
  <body>
    <h1>Dynamic List</h1>
    <form id="additem">
      <input type="text" id="item" placeholder="Summary">
      <button id="add">Add</button>
      <button type="reset">Reset</button>
    </form>
    <ul id="list"></ul>
    <button id="clearlist">Clear list</button>
  </body>
</html>
```

* Notice that with this input, we don't use a label. Instead, we use a placeholder.
* Note that the `add` button has no type. This means it will be a submit button.
* The reset button the the `type="reset"`, which will reset the form.

![image-20230418151123584](attachments/cs193x.assets/image-20230418151123584.png)

```js
import Item from "./item.js";

class List {
  constructor() {
    
    // bind the event listener function
    this._handleAdd = this._handleAdd.bind(this);

    // add the event listener to the button
    this._form = document.forms.additem;
    // Putting the event listener on the Add button
    this._form.add.addEventListener("click", this._handleAdd);
    

  }

  _handleAdd(event) {
    console.log("Clicked");
  }
}
new List();
```

* With the JS code above, whenever we click Add or Reset, it will show "Clicked" in the console.
* However, note that when you click on `Add`, it will refresh the page.
  * This is because it's a submit button. Submit buttons are also useful because of keyboard shortcuts.
  * If I type something in the text box and click enter, it will treat it as if the button `Add` was clicked.

```js
import Item from "./item.js";

class List {
  constructor() {
    
    // bind the event listener function
    this._handleAdd = this._handleAdd.bind(this);

    // add the event listener to the button
    this._form = document.forms.additem;
    // Putting the event listener on the Add button
    // this._form.add.addEventListener("click", this._handleAdd);
    
    // Recommended: put the event listener on the form
    this._form.addEventListener("submit", this._handleAdd);

  }

  _handleAdd(event) {
    // prevent the default behavior with how browser submission works
    // this tells it to use our own submit type
    event.preventDefault();
    console.log("Clicked");
  }
}
new List();
```

* The code above is better. Adding the form directly with the submit keyword tells it to use our function when we submit.

```js
import Item from "./item.js";

class List {
  constructor() {
    
    // bind the event listener function
    this._handleAdd = this._handleAdd.bind(this);

    // add the event listener to the button
    this._form = document.forms.additem;
    // Putting the event listener on the Add button
    // this._form.add.addEventListener("click", this._handleAdd);
    
    // Recommended: put the event listener on the form
    this._form.addEventListener("submit", this._handleAdd);

  }

  _handleAdd(event) {
    // prevent the default behavior with how browser submission works
    // this tells it to use our own submit type
    event.preventDefault();
    
    // get the text from the text input box
    let summary = this._form.item.value;
    // create an element
    let item = document.createElement("li");
    item.textContent = summary;
    document.body.children.list.append(item);
  }
}
new List();
```

* We can edit the js directly to show the list on our page.

![image-20230418152327175](attachments/cs193x.assets/image-20230418152327175.png)

#### Item

* Suppose now we want each of our items to be an object of an Item class, instead of making it in the handle click file.

```js
export default class Item {
  constructor(summary) {
    // create a list element
    this._elem = document.createElement("li"); 
    this._elem.textContent = summary;
  }

  // adds our element to the list tree in the HTML
  // list is a list element to append the item to
  addToList(list) {
    list.append(this._elem);
  }
}
```

* Now, we can edit our other js file to incorporate this class.

```js
import Item from "./item.js";

class List {
  constructor() {
    
    // bind the event listener function
    this._handleAdd = this._handleAdd.bind(this);

    // add the event listener to the button
    this._form = document.forms.additem;
    // Putting the event listener on the Add button
    // this._form.add.addEventListener("click", this._handleAdd);
    
    // Recommended: put the event listener on the form
    this._form.addEventListener("submit", this._handleAdd);

  }

  _handleAdd(event) {
    // prevent the default behavior with how browser submission works
    // this tells it to use our own submit type
    event.preventDefault();
    
    // get the text from the text input box
    let summary = this._form.item.value;
    // create an element
    let item = new Item(summary);
    let list = document.body.children.list;
    item.addToList(list)

    // wipe the inputs
    this._form.reset();
  }
}
new List();

```

#### Delete Button

* Since our items are now in a class, we can add functionality without much work. For example, we can make a delete button for each item.

```js
export default class Item {
  constructor(summary) {
    // create a list element
    this._elem = document.createElement("li"); 
    this._elem.textContent = summary;

    // add a delete button for that item
    let delBtn = document.createElement("button");
    // make sure to give the button some text
    delBtn.textContent = "Delete";

    // bind the handler
    this.removeFromList = this.removeFromList.bind(this);
    // note that this button isn't in the HTML yet
    delBtn.addEventListener("click", this.removeFromList);

    // add the delete button to after this element
    /* note that order matters. Setting the textContent will remove
      all the children, so we need to add children after text content */
    this._elem.append(delBtn);
  }

  // adds our element to the list tree in the HTML
  // list is a list element to append the item to
  addToList(list) {
    list.append(this._elem);
  }

  removeFromList() {
    // this will remove this whole element, removing it from the list
    this._elem.remove();
  }
}
```

* We don't have to make any changes to our original `list.js` file. Since it's a class, this delete button just gets added.

#### Clear List Button

* We can use arrays to store these items, so that we can easily clear them.

```js
import Item from "./item.js";

class List {
  constructor() {
    // bind the event listener function
    this._handleAdd = this._handleAdd.bind(this);
    this._handleClear = this._handleClear.bind(this);

    // list to keep the items
    this._items = [];

    // add the event listener to the button
    this._form = document.forms.additem;
    // Putting the event listener on the Add button
    // this._form.add.addEventListener("click", this._handleAdd);
    
    // Recommended: put the event listener on the form
    this._form.addEventListener("submit", this._handleAdd);

    // query selector, the # tells us to select something by id
    document.querySelector("#clearlist").addEventListener("click", this._handleClear); // the id of our clearlist button is this
  }

  _handleClear() {
    // we don't need event.eventDefault() because this clear button is outside of a form
    for (let item of this._items) {
      // remove each item from the list on the html
      item.removeFromList();
    }
    alert(`Removed ${this._items.length} items.`);
    // clear the array itself
    this._items = []
  }

  _handleAdd(event) {
    // prevent the default behavior with how browser submission works
    // this tells it to use our own submit type
    event.preventDefault();
    
    // get the text from the text input box
    let summary = this._form.item.value;
    // create an element
    let item = new Item(summary);
    let list = document.body.children.list;
    item.addToList(list)
    this._items.push(item);
    this._form.reset();
  }
}
new List();
```

* Notice that `_handleClear` handler function above. It does the logic for the clear list button.
* However, there is an issue with the above.

![image-20230418160053551](attachments/cs193x.assets/image-20230418160053551.png)

* If I use the `delete` button above, the clear list button will still think there is still 2 items to clear because the delete button doesn't update the list.

![image-20230418160127822](attachments/cs193x.assets/image-20230418160127822.png)

![image-20230418160134208](attachments/cs193x.assets/image-20230418160134208.png)

* To do this, we add our own callback function in our handlers.

```js
export default class Item {
  constructor(summary) {
    // create a list element
    this._elem = document.createElement("li"); 
    this._elem.textContent = summary;

    // add a delete button for that item
    let delBtn = document.createElement("button");
    // make sure to give the button some text
    delBtn.textContent = "Delete";

    // bind the handler
    this.removeFromList = this.removeFromList.bind(this);
    this._handleDel = this._handleDel.bind(this);
    // note that this button isn't in the HTML yet
    delBtn.addEventListener("click", this._handleDel);

    // add the delete button to after this element
    /* note that order matters. Setting the textContent will remove
      all the children, so we need to add children after text content */
    this._elem.append(delBtn);
  }

  // adds our element to the list tree in the HTML
  // list is a list element to append the item to
  addToList(list, onRemove) {
    list.append(this._elem);
    // store the callback function that is used when something is deleted
    this._onRemove = onRemove;
  }
	
    // use for clearing the whole list later on
  removeFromList() {
    // this will remove this whole element, removing it from the list
    this._elem.remove();
  }

    // used for the delete button
  _handleDel() {
    this._elem.remove();
    // check if the onremove function is not null
    if (this._onRemove) {
      // call the onRemove function with ourself as a parameter
      this._onRemove(this);
    }
  }
}

```

* The `onRemove` function is a function that the client gave us, that we should call when we try to remove the item.
* We then add the following in the `list.js` function to handle this onRemove.

```js
import Item from "./item.js";

class List {
  constructor() {
    // bind the event listener function
    this._handleAdd = this._handleAdd.bind(this);
    this._handleClear = this._handleClear.bind(this);
    // we need to bind this one because we'll be passing this function to another class (the item class)
    this._handleRemove = this._handleRemove.bind(this);

    // list to keep the items
    this._items = [];

    // add the event listener to the button
    this._form = document.forms.additem;
    // Putting the event listener on the Add button
    // this._form.add.addEventListener("click", this._handleAdd);
    
    // Recommended: put the event listener on the form
    this._form.addEventListener("submit", this._handleAdd);

    // query selector, the # tells us to select something by id
    document.querySelector("#clearlist").addEventListener("click", this._handleClear); // the id of our clearlist button is this
  }

  _handleClear() {
    // we don't need event.eventDefault() because this clear button is outside of a form
    for (let item of this._items) {
      // remove each item from the list on the html
      item.removeFromList();
    }
    alert(`Removed ${this._items.length} items.`);
    // clear the array itself
    this._items = []
  }

  _handleAdd(event) {
    // prevent the default behavior with how browser submission works
    // this tells it to use our own submit type
    event.preventDefault();
    
    // get the text from the text input box
    let summary = this._form.item.value;
    // create an element
    let item = new Item(summary);
    let list = document.body.children.list;
    item.addToList(list, this._handleRemove)
    this._items.push(item);
    this._form.reset();
    
  }

  _handleRemove(item) {
    // remove the item from the array
    this._items.splice(this._items.indexOf(item), 1);
  }
}
new List();

```

### Accessing DOM Elements

* We can access using querySelector

![image-20230425150800270](attachments/cs193x.assets/image-20230425150800270.png)

---

## 4/20 L6: Styling and CSS

### Semantic elements

* Elements serve two purposes: semantics and presentation

![image-20230420150903075](attachments/cs193x.assets/image-20230420150903075.png)

### Page regions

![image-20230420151249866](attachments/cs193x.assets/image-20230420151249866.png)

### HTML quirks

![image-20230420151302556](attachments/cs193x.assets/image-20230420151302556.png)

* By default, headings take up a line by itself.
* However, paragraphs don't have line breaks by default. It will collapse it into one line.

### Styling elements

![image-20230420152551521](attachments/cs193x.assets/image-20230420152551521.png)

#### Code

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Intro to CSS | Lecture 6</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="index.js"></script>
  </head>
  <body>
    <header>
      <h1 id="title">CS 193X</h1>
      <h2>Spring 2023</h2>
    </header>
    <main>
      <p>
        Web dev is <strong class="word">awesome!</strong><br>
        ...except some things can be <em class="word">very</em> unexpected...
      </p>
      <img src="stanford.png">
    </main>
    <footer>
      <a href="https://www.google.com/">Google</a>
    </footer>
  </body>
</html>
```

* The `index.html` above creates the following page.

![image-20230420152101955](attachments/cs193x.assets/image-20230420152101955.png)

* Notice that the two headings are on their own line without any line breaks, but the paragraph needs line breaks.

#### Style

* Notice that in the HTML code above, the `CS193X` title has the id of `title`.
* We can use this with `querySelector` to reference it in JS and do stuff with it.

```js
const main = () => {
  let title = document.querySelector("#title");
  title.style.color = "#1f8fad";
  title.style.border = "1px dashed" // can also put solid
};
main();
```

* The code above is placed in the `index.js` file, which was included in the HTML.

![image-20230420152336978](attachments/cs193x.assets/image-20230420152336978.png)

* Notice that the border takes up the whole page, not just the text. This is related to how headings take up their own line.

```js
const main = () => {
  let title = document.querySelector("#title");
  title.style.display = "none";
};
main();
```

* With the above, we can make the element disappear from the page.

![image-20230420152426118](attachments/cs193x.assets/image-20230420152426118.png)

### CSS slides

* We don't want to use HTML to describe our presentation because it can get clunky.
* We don't want to use JS to describe our presentation because we can't reuse it for multiple elements.
* Instead, we use CSS.

![image-20230420152647051](attachments/cs193x.assets/image-20230420152647051.png)

![image-20230420152619652](attachments/cs193x.assets/image-20230420152619652.png)

![image-20230420152635345](attachments/cs193x.assets/image-20230420152635345.png)

### CSS

* When the browser loads, the first thing it does is just to load `index.html`.
* From there, anything defined in `index.html` is ran. As such, we need to include the css file in our html.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Intro to CSS | Lecture 6</title>

    <!-- Define the relation as a stylesheet and get css -->
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="index.js"></script>
  </head>
</html>
```

* We now define stuff in our `styles.css` file, to define how styles should be.
* In our CSS file, we need to *select* elements to style, and we need to set how we style those elements.
  * We have selectors to select elements, and properties to style.

```css
/* Select all <p> elements */
p {
  /* Make their text lightgreen */
  color: lightgreen;
  /* Make the background color gray */
  background-color: gray;
}
```

* The code above selects all paragraphs (anything with the tag of p). Then, modifies the properties of paragraphs.

![image-20230420153738868](attachments/cs193x.assets/image-20230420153738868.png)

* If you have both javascript and css, the styles defined in javascript will be what is shown
  * When the page loads, it loads all the HTML. Then, it reads all the css to see how it should style. Then, JS is run.

* We can also select certain items by their id.

```html
  <body>
    <header>
      <h1 id="title">CS 193X</h1>
      <h2>Spring 2023</h2>
    </header>
    <main>
      <p>
        Web dev is <strong class="word">awesome!</strong><br>
        ...except some things can be <em class="word">very</em> unexpected...
      </p>
      <img id="seal" src="stanford.png">
    </main>
    <footer>
      <a href="https://www.google.com/">Google</a>
    </footer>
  </body>
</html>
```

* Consider the seal. We gave it an id of seal

```css
/* Select the seal */
#seal {
  width: 100px;
  /* If we don't specify the height, it keeps the
    aspect ratio */
  height: 40px;
    
}
```

![image-20230420155119636](attachments/cs193x.assets/image-20230420155119636.png)

### CSS class

```html
<p>
    Web dev is <strong class="word">awesome!</strong><br>
    ...except some things can be <em class="word">very</em> unexpected...
</p>
```

* Notice how the `strong` tag has a class, and the `em` tag also has a class.
  * For reference, strong is bold and em is italic.

* Below is the before.

![image-20230420155303638](attachments/cs193x.assets/image-20230420155303638.png)

```css
/* Select the word class */
.word {
  font-family: monospace;
  text-decoration: underline;
  font-weight: bold;
}
```

![image-20230420155338941](attachments/cs193x.assets/image-20230420155338941.png)

* Notice that the `strong` tag and the `font-weight: bold` both makes text bold.
  * You should use either based on the semantics. If you want to make something stand out from the rest of the paragraph, use the `strong` tag.
  * Otherwise (ie. the heading is bold, but it's not something we necessarily want to make stand out), use the `font-weight: bold`.
* Note that some properties don't work on all elements. For example, you can't set a width on a text tag (e.g. strong / em)

```css
/* Select the word class */
.word {
  font-family: monospace;
  text-decoration: underline;
  font-weight: bold;
  width: 100;
}
```

* Adding the width above makes no change to our page.

![image-20230420155640451](attachments/cs193x.assets/image-20230420155640451.png)

* We revisit the style of the border

```css
#seal {
  width: 100px;
  border: 2px solid black
}
```

![image-20230420160000421](attachments/cs193x.assets/image-20230420160000421.png)

* The css above is the same as the below.

```css
/* Select the seal */
#seal {
  width: 100px;
  /* border: 2px solid black */
  border-width: 2px;
  border-style: solid;
  border-color:black;
}
```

* You can also have more specific selectors, selecting more than one criteria about a thing.

```css
/* Select strong elements with the word class */
strong.word {
  font-family: monospace;
  color: red;
}
```

![image-20230420160414834](attachments/cs193x.assets/image-20230420160414834.png)

* You can also have multiple selectors, called descendent selector

```css
/* Select all elements with the class .word inside a <p> */
p .word {
  color: blue
}
```

![image-20230420160520408](attachments/cs193x.assets/image-20230420160520408.png)

#### Ordering

* If one element has multiple selectors and styles for it, the one that is more specific will take precedence.

* Consider the following HTML. Notice that the link google has the word class.

```html
<body>
  <header>
    <h1 id="title">CS 193X</h1>
    <h2>Spring 2023</h2>
  </header>
  <main>
    <p>
      Web dev is <strong class="word">awesome!</strong><br>
      ...except some things can be <em class="word">very</em> unexpected...
    </p>
    <img id="seal" src="stanford.png">
  </main>
  <footer>
    <a class="word" href="https://www.google.com/">Google</a>
  </footer>
</body>
```

* Now we have the following CSS.

```css
/* Select the word class */
.word {
  font-family: monospace;
  text-decoration: underline;
  font-weight: bold;
  width: 100;
  color: red;
}
```

![image-20230420161014046](attachments/cs193x.assets/image-20230420161014046.png)

* The above colors all the elements with the word class red.

* However, if we now add this into the css

```css
/* Select all elements with the class .word inside a <p> */
p .word {
  color: blue
}
```

* Notice that all the tags inside the paragraph with the word class is changed to blue

![image-20230420161202252](attachments/cs193x.assets/image-20230420161202252.png)

#### Recap

* In CSS, to select all the things with a particular tag, simply write that tag.
  * E.g. using the `p` tag
* To select all the things with a particular id, use the hashtag
  * E.g. using the `#seal` thing
* To select all the things with a class, use the dot
  * E.g. using the `.word`

#### Inheritance

* If an element doesn't have a property, it will look at the parent to find its properties.
* For example, if we set the font properties of the body, it'll modify everything on the page.

* Below is the before.

![image-20230420162010030](attachments/cs193x.assets/image-20230420162010030.png)

* If I now add the following to my CSS file.

```css
body {
  font-family: monospace;
}
```

![image-20230420162038191](attachments/cs193x.assets/image-20230420162038191.png)

* All the elements without font properties inherits it and the font is changed.

### CSS selectors

![image-20230425151052809](attachments/cs193x.assets/image-20230425151052809.png)

![image-20230425151106313](attachments/cs193x.assets/image-20230425151106313.png)

---

## 4/25 L7: CSS Layouts

### Query Selector and classes

* We can use the `classList` property to add classes to an element.

```js
const addClass = () => {
  let elem = document.querySelector("strong");
  elem.classList.add("word");
};
```

* We can also use it to remove classes from an element. In the code below, this removes the class `word` from all elements.

```js
const remClass = () => {
  for (let elem of document.querySelectorAll(".word")) {
    elem.classList.remove("word");
  }
};
```

* We can also use the query selector to add event listeners to specific buttons, like below:

```js
const main = () => {
  document.querySelector("#addClass").addEventListener("click", addClass);
  document.querySelector("#remClass").addEventListener("click", remClass);
};
main();
```

### Pseudoclasses

![image-20230425152410200](attachments/cs193x.assets/image-20230425152410200.png)

* We can use the colon to select pseudoclasses in CSS to edit links.
* Below is how the links look originally.

![image-20230425152435486](attachments/cs193x.assets/image-20230425152435486.png)

```css
a { /* all links */
  color: green;
}

/* notice that this rule is more specific, so the link stays */
a:visited { /* visited links */
  color: #8c1515;
}
```

![image-20230425152618717](attachments/cs193x.assets/image-20230425152618717.png)

* We can also inherit any CSS property. This basically means it will use the value from the parent.

```css
a { /* all links */
  color: #8c1515;
}

/* notice that this rule is more specific, so the link stays */
a:visited { /* visited links */
  /* use value from parent */
  color: inherit;
}
```

![image-20230425152737760](attachments/cs193x.assets/image-20230425152737760.png)

* Since there isn't an explicit color for the `inherit`, the browser defaults to black.

```css
a:link { /* unvisited */
  color: gray;
}
```

![image-20230425153123675](attachments/cs193x.assets/image-20230425153123675.png)

* You can also make stuff happen when you hover over it. In the case below, the link and the button both turn blue when you hover your mouse over it.

```css
a:hover, button:hover { /* style when mouse hovers */
  color: blue
}
```

![image-20230425153225350](attachments/cs193x.assets/image-20230425153225350.png)

* In the above, the ouse is hovering over `Remove class`

### Page Layout

![image-20230425151454698](attachments/cs193x.assets/image-20230425151454698.png)

* Notice that there is the `display` css property in the `h1` below.

![image-20230425153457932](attachments/cs193x.assets/image-20230425153457932.png)

* The `display: block` essentially tells it to take up the whole line

![image-20230425152128753](attachments/cs193x.assets/image-20230425152128753.png)

* You can override this display property for certain things.

* This is how the page looks initially

  ![image-20230425153607101](attachments/cs193x.assets/image-20230425153607101.png)

#### Inline and block

* In the case below, we make the headings become `inline`.

```css
h1, h2 {
  display: inline;
}
```

![image-20230425153633512](attachments/cs193x.assets/image-20230425153633512.png)

* With `inline`, you can't set the height and width of it. 

```css
h1, h2 {
  display: inline;
  height: 100px;
  border: 1px solid gray;
}
```

![image-20230425153844267](attachments/cs193x.assets/image-20230425153844267.png)

```css
h1, h2 {
  /* display: inline; */
  height: 100px;
  border: 1px solid gray;
}
```

![image-20230425153909031](attachments/cs193x.assets/image-20230425153909031.png)

* We can also set the size of objects on the screen. In this case, we set the image.

```css
img {
  /* 10em is roughly 10 characters wide, by the font */
  width: 10em;
}
```

![image-20230425154105133](attachments/cs193x.assets/image-20230425154105133.png)

* Note that images are not blocks. They are inline. In the case below, if we add text after the image, it goes on the same line.

```html
<main>
  <p>
    Web dev is <strong class="word">awesome!</strong><br>
  </p>
  <img id="seal" src="stanford.png">
  Text after image.
</main>
```

![image-20230425154202354](attachments/cs193x.assets/image-20230425154202354.png)

#### Inline-block

* This is inline, but allows you to set the width and height.

```css
h1, h2 {
  display: inline-block;
  height: 100px;
  border: 1px solid gray;
}
```

![image-20230425154313430](attachments/cs193x.assets/image-20230425154313430.png)

#### div and span

* `<div>` simply mean a generic block element
* `<span>` simply mean a generic inline element
* Neither have any semantics or default presentation. It just essentially notes that the stuff is a block.
  * Simply used when you want to wrap something in a tag to do some CSS styling to it.
* You should use this if you want something generic without semantics. If there is something more precise, use that.

### The Box Model

![image-20230425155237648](attachments/cs193x.assets/image-20230425155237648.png)

![image-20230425155243850](attachments/cs193x.assets/image-20230425155243850.png)

![image-20230425155250113](attachments/cs193x.assets/image-20230425155250113.png)

![image-20230425155258274](attachments/cs193x.assets/image-20230425155258274.png)

#### Example

* Below is our starting HTML for the following page.

```html
  <body>
    <div class="outer">
      <div class="inner">
        Text inside the box.
      </div>
      <div class="inner second">
        More text inside a similar but different box.
      </div>
    </div>

    <p class="para">
      Let's explore
      <span>how the box model affects inline elements</span>
      by styling the span.
    </p>
  </body>
```

* Notice that the second box has multiple classes. Below is the CSS for our page.

```css
.outer {
  border: 2px solid black;
  width: 400px;
  height: 400px;
}

.inner {
  background-color: lightgray;
  border: 2px solid blue;

  width: 100px;
  height: 100px;
}

.second {
  background-color: green;
}

.para {
  border: 2px dashed red;
  width: 200px;
}

.para span {
  border: 2px solid #007fff;
}
```

![image-20230425155545448](attachments/cs193x.assets/image-20230425155545448.png)

* Notice the last thing in the css file.

```css
.para span {
  border: 2px solid #007fff;
}
```

* This is a descendent selector. This allows us to get all the `span`s that are inside the `para` class.
* Notice that the border of that span is broken, because it's inline.
  * Note: don't do borders around inline elements because it can look very odd.

#### Margins

* You can put margins into block elements like below:

```css
.inner {
  background-color: lightgray;
  border: 2px solid blue;

  width: 100px;
  height: 100px;

  padding: 10px;
  margin: 20px 30px 40px 50px; /* top right bottom left */
}
```

![image-20230425160256084](attachments/cs193x.assets/image-20230425160256084.png)

* We can also do margins like this

```css
margin: 20px 100px; /* top/bottom margin, left/right margin */
```

* You can put also put margins into inline elements, but it may not work as expected.

```css
.para span {
  border: 2px solid #007fff;
  margin: 20px;
}
```

![image-20230425160530168](attachments/cs193x.assets/image-20230425160530168.png)

* Vertical margins and padding doesn't work with inline elements.

```css
.para span {
  border: 2px solid #007fff;
  /* vertical spacing doesn't work for inline elements */
  margin: 20px;
  padding: 0 20px;

  /* can use line-height to change vertical spacing */
  line-height: 2em;
}
```

![image-20230425160847530](attachments/cs193x.assets/image-20230425160847530.png)

#### Margin collapsing

* Vertical margins of adjacent elements collapse to use the bigger margin.

```css
.inner {
  background-color: lightgray;
  border: 2px solid blue;

  width: 100px;
  height: 100px;

  padding: 10px;
  margin-bottom: 10px;
}

.second {
  background-color: green;
  margin-top: 10px;
}
```

* Notice the margin-top and margin-bottom. In this case, it only does 10px, not both (20px).

![image-20230425161120502](attachments/cs193x.assets/image-20230425161120502.png)

#### Box Sizing

* The CSS for out box is below:

```css
.inner {
  background-color: lightgray;
  border: 2px solid blue;

  width: 100px;
  height: 100px;

  padding: 10px;
  margin: 2em 2em;
}
```

* Note that because of the border and padding, our box is not `100px`. It is actually `122 px`, including the padding and border.

![image-20230425161608139](attachments/cs193x.assets/image-20230425161608139.png)

* You can fix this by using the `border-box` property.

```css
.inner {
  background-color: lightgray;
  border: 2px solid blue;

  box-sizing: border-box;
  width: 100px;
  height: 100px;

  padding: 10px;
  margin: 2em 2em;
}
```

![image-20230425161638368](attachments/cs193x.assets/image-20230425161638368.png)

* Notice now that the sum of the box size, the padding, and the border, actually sum up to `100px`.

* One way to make every box use `border-box` like below:

```css
* {
  box-sizing: border-box;
}
```

* However, the preferred way is to do it like this:

```css
:root {
  box-sizing: border-box;
}

* {
  box-sizing: inherit;
}
```

* This works because box-sizing is not instantly inherited. At the root, we set everything to be border-box. Now, everything under the root is set to the parent's box-sizing, which is the border-box that we inherited.

---

## 4/27 L8: More CSS

### Flexbox

![image-20230427150838703](attachments/cs193x.assets/image-20230427150838703.png)

#### Properties

![image-20230427150904044](attachments/cs193x.assets/image-20230427150904044.png)

![image-20230427150935144](attachments/cs193x.assets/image-20230427150935144.png)

#### Example

![image-20230427151359743](attachments/cs193x.assets/image-20230427151359743.png)

```css
:root {
  box-sizing: border-box;
}

* {
  box-sizing: inherit;
}

div {
  margin: 5px;
}

.outer {
  border: 2px solid black;
  width: 400px;
  height: 150px;
}

.outer div {
  background-color: lightgray;
  border: 2px solid blue;
  width: 50px;
  height: 40px;
}
```

---

* Below, we add this to turn the boxes into a flex box. Notice that the default `flex-direction` is row.

```css
.outer { /* outer is now a flex container */
  display: flex;
}
```

![image-20230427151512876](attachments/cs193x.assets/image-20230427151512876.png)

---

* If we want to change between rows and columns, use `flex-direction`

![image-20230427151538888](attachments/cs193x.assets/image-20230427151538888.png)

```css
.outer { /* outer is now a flex container */
  display: flex;
  flex-direction: column;
}
```

* If you want to center it in the cross direction of the row/column, use `align-items`

![image-20230427151713161](attachments/cs193x.assets/image-20230427151713161.png)

```css
.outer { /* outer is now a flex container */
  display: flex;
  flex-direction: column;
  /* center of horizontal, which is cross of column */
  align-items: center;
}
```

---

* Remember that `align-items` aligned across the cross axis.
* We can use `justify-content` to align across the main axis.

```css
.outer { /* outer is now a flex container */
  display: flex;
  flex-direction: row;
  /* center of vertical, which is cross of row */
  align-items: center;
  /* right of horizontal, which is main of row */
  justify-content: flex-end;
}
```

![image-20230427152020968](attachments/cs193x.assets/image-20230427152020968.png)

---

* Use `space-between` with `justify-content` to lay it out evenly with the space in between on the main axis.

```css
.outer { /* outer is now a flex container */
  display: flex;
  flex-direction: row;
  /* center of vertical, which is cross of row */
  align-items: center;
  /* right of horizontal, which is main of row */
  justify-content: space-between;
}
```

![image-20230427152104752](attachments/cs193x.assets/image-20230427152104752.png)

---

* There is also a `space-around` for `justify-content`. This aligns it equally based on the entire space around the elements.

```css
.between {
  justify-content: space-between;
}

.around {
  justify-content: space-around;
}
```

* The top box is the `between`, the bottom box is the `around`.

![image-20230427152246540](attachments/cs193x.assets/image-20230427152246540.png)

---

* If we want to affect the boxes inside the boxes, we can do it like below:

```css
.outer div {
  background-color: green;
  border: 2px solid red;
  width: 50px;
  height: 40px;
}
```

* The `.outer div` basically selects all the `div`s *inside* things with the `outer` class.

![image-20230427152428116](attachments/cs193x.assets/image-20230427152428116.png)

---

#### Flexbox Grow

* Below is our original CSS and what shows on the screen.

```css
:root { /* root element (html) */
  box-sizing: border-box;
}

* { /* inherit box-sizing from parent */
  box-sizing: inherit;
}

.outer {
  border: 2px dashed black;
  width: 404px;
  height: 204px;
  margin: 5px;
}

.outer div, .outer span {
  background-color: lightgray;
  border: 2px solid blue;
  margin: 5px;
}
```

```html
<div class="outer grow">
  <div class="first">
    Elem 1
    <div>Sub elem</div>
  </div>
  <span class="second">Elem 2</span>
  <div class="third">Elem 3</div>
</div>
```

![image-20230427152800525](attachments/cs193x.assets/image-20230427152800525.png)

---

* We now turn the above into flexboxes by adding this.

```css
.outer {
  display: flex;
  /* the default align-items is stretch */
  justify-content: space-between;
}
```

![image-20230427152946715](attachments/cs193x.assets/image-20230427152946715.png)

* Notice that the boxes are now in a row and stretched vertically. This is the default behavior if the height/width are not set for flexboxes.

---

* We can make an item grow in size to fill up the remaining space.

```css
.second { /* flex-grow applied to item, not container */
  flex-grow: 1;
}
```

![image-20230427153036531](attachments/cs193x.assets/image-20230427153036531.png)

---

* We can have multiple items grow. In this case, if both `first` and `second` has `flex-grow: 1`, then each gets up the same amount of the remaining space.

```css
.second {
  flex-grow: 1;
}

.first {
  flex-grow: 1;
}
```

![image-20230427153146049](attachments/cs193x.assets/image-20230427153146049.png)

* If `first` has `flex-grow: 2` and `second` has `flex-grow: 1`, then the first box will take up twice the amount of remaining space. Note that this does not mean the two boxes will be equal size.

![image-20230427153407224](attachments/cs193x.assets/image-20230427153407224.png)

---

* We can also apply this to all the children.

```css
/* .first, .second, .third */
.grow > div { /* divs that are direct children of .grow */
  flex-grow: 1;
}
```

![image-20230427153550357](attachments/cs193x.assets/image-20230427153550357.png)

---

#### Flexbox Shrink

* This tells elements to give up space to fit in the box, if other boxes are too big.

```html
<div class="outer shrink">
  <div class="large">This box has a lot of text and will want to expand as much as it can</div>
  <div class="small">Box 2</div>
</div>
```

![image-20230427153722865](attachments/cs193x.assets/image-20230427153722865.png)

* Notice that because of the text in the left box, the right box is shrinking. To prevent this, we can do the following:

```css
.small {
  flex-shrink: 0;
}
```

![image-20230427153812262](attachments/cs193x.assets/image-20230427153812262.png)

* This will preserve the original defined width of the box, preventing it from shrinking as an affect of other boxes.

![image-20230427153848276](attachments/cs193x.assets/image-20230427153848276.png)

---

#### Flexbox wrapping

* This essentially tells elements to wrap to the next row/column if necessary.

```html
<div class="outer wrap">
  <div>First element</div>
  <div>Second element</div>
  <div>Third element</div>
  <div>Fourth element</div>
  <div>Fifth element</div>
</div>
```

![image-20230427153924715](attachments/cs193x.assets/image-20230427153924715.png)

* Now to make it wrap, we can do the following:

```css
.wrap {
  flex-wrap: wrap;
}
```

![image-20230427154036435](attachments/cs193x.assets/image-20230427154036435.png)

---

* This wrapping behavior also works with columns. Suppose we had the following box:

![image-20230427154130253](attachments/cs193x.assets/image-20230427154130253.png)

* If we add the wrap, we have

```css
.wrap {
  flex-direction: column;
  flex-wrap: wrap;
}
```

![image-20230427154146381](attachments/cs193x.assets/image-20230427154146381.png)

---

### Gap

* We can also set the gap between elements.
* Using the same layout from above, we have the following

```css
.wrap {
  flex-direction: column;
  gap: 20px;
  flex-wrap: wrap;
}
```

![image-20230427154246057](attachments/cs193x.assets/image-20230427154246057.png)

### More CSS selectors

![image-20230427154326106](attachments/cs193x.assets/image-20230427154326106.png)

### Units

![image-20230427154331690](attachments/cs193x.assets/image-20230427154331690.png)

![image-20230427155204341](attachments/cs193x.assets/image-20230427155204341.png)

![image-20230427155233415](attachments/cs193x.assets/image-20230427155233415.png)

---

#### Example

* Below is an example of these units.

![image-20230427155316717](attachments/cs193x.assets/image-20230427155316717.png)

```html
<p class="scaled-text">This text scales with the browser's font size</p>
<p class="fixed-text">This text has a fixed size</p>
<div class="container">
  <div class="scaled-box">
    This box's dimensions and spacing scale with font size.
  </div>
  <div class="fixed-box">
    This box's dimensions and spacing are fixed
  </div>
</div>
<h1 class="rem-box">
  This box's spacing are based on the browser font size
</h1>
<div class="viewport-height">
  Make this box's height 50% of the window height
</div>
```

```css
:root {
  box-sizing: border-box;
}

* {
  box-sizing: inherit;
}

/* uses font size keyword to scale with browser font */
.scaled-text {
  font-size: large;
}

/* absolute font size with pixels */
.fixed-text {
  font-size: 20px;
}

.container {
  display: flex;
  /* Change the font size to see its effect */
  font-size: 16px;
}

.fixed-box {
  border: 2px solid black;
  width: 192px;
  height: 80px;
  margin: 16px;
  padding: 4px;
}

.scaled-box {
  border: 0.125em solid black;
  width: 12em;
  height: 5em;
  margin: 1em;
  padding: 0.25em;
}

.rem-box {
  border: 2px solid black;
  padding: 2rem;
}

.viewport-height {
  border: 2px solid black;
}
```

* `px` is absolute units.
* `em` is relative units, it's based on the font size.

---

* You can also work with percentages.

```css
.viewport-height {
  border: 2px solid black;
  width: 50%; /* 50% of the container's width */
}
```

![image-20230427160331840](attachments/cs193x.assets/image-20230427160331840.png)

---

* If we want to talk about the browser window itself, use `vh` and `vw`.

```css
.viewport-height {
  border: 2px solid black;
  width: 50vw; /* 50% of the browser's width */
  height: 20vh; 
}
```

![image-20230427160506953](attachments/cs193x.assets/image-20230427160506953.png)

---

### Position

![image-20230427160547764](attachments/cs193x.assets/image-20230427160547764.png)

![image-20230427160557835](attachments/cs193x.assets/image-20230427160557835.png)

---

#### Example

* This is an example of how we can use position to do stuff.

![image-20230427160637249](attachments/cs193x.assets/image-20230427160637249.png)

```css
/* Rules to set sizing and colors */
:root { box-sizing: border-box; }
* { box-sizing: inherit; }

body {
  background: linear-gradient(#ffc0c0, #c0c0ff);
  height: 2000px; /* Big enough to get a scrollbar */
}

.box, .outer {
  background-color: white;
  margin: 10px;
  padding: 10px;
}

.box {
  border: 2px solid black;
  width: 100px;
  height: 100px;
}

.outer {
  border: 2px dashed cyan;
  width: 300px;
  height: 300px;
}
```

```html
<div class="bigbox">
  <div class="box">A box</div>
  <div class="box relative">A box with relative position</div>
  <div class="box">A third box</div>
  <div class="outer">
    <div class="box absolute">An absolute box</div>
    <div class="box">A not absolute box</div>
  </div>
  <div class="box fixed">Box the fixed</div>
</div>
```

---

* The default is `position: static`. It basically means this thing won't move.

---

#### Relative Position

* You can move the item relative to where it was before.

```css
.relative {
  position: relative;
  top: 50px;
  left: 200px;
}
```

| Original                                                     | Relative                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20230427161009350](attachments/cs193x.assets/image-20230427161009350.png) | ![image-20230427160949494](attachments/cs193x.assets/image-20230427160949494.png) |

* The `css` basically tells that box to have a margin of `50px` on the top and `200px` from the left, relative to its original position.

---

#### Absolute Position

* When we set something as absolute, we basically say that that item is no longer part of the page.
* The location we give must now be relative to the body.

```css
.absolute {
  position: absolute;
  top: 20px;
  left: 100px;
}
```

| Original                                                     | Relative                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20230427161307476](attachments/cs193x.assets/image-20230427161307476.png) | ![image-20230427161252390](attachments/cs193x.assets/image-20230427161252390.png) |

* If we want to change where the `absolute` makes itself relative to, we can set theo outer box to be relative.

```css
.outer {
  position: relative;
  /* Children use this box as a reference point for position: absolute */
}

.absolute {
  position: absolute;
  top: 20px;
  left: 100px;
}
```

![image-20230427161400550](attachments/cs193x.assets/image-20230427161400550.png)

---

### Fixed Position

* If we wanted something relative to the viewport, we can use fixed.
* This will stay where it is as long as you scroll.

```css
.fixed {
  position: fixed;
  bottom: 0;
  right: 10em;
}
```

![image-20230427161552498](attachments/cs193x.assets/image-20230427161552498.png)

![image-20230427161557955](attachments/cs193x.assets/image-20230427161557955.png)

* Notice that it stays where it is even if you scroll.

---

## 5/2 L9: fetch, async/await, APIs

![image-20230502151250605](attachments/cs193x.assets/image-20230502151250605.png)

* Dynamic content is data that changes. It's difficult to do this on a static web page.

![image-20230502151258494](attachments/cs193x.assets/image-20230502151258494.png)

![image-20230502151835638](attachments/cs193x.assets/image-20230502151835638.png)

* The above runs in the browser, but the data is still embedded in the page structure like HTML.

---

### APIs

* Stands for application programming interface
* Basically is an interface/protocol (a way for two pieces of code/systems to talk to each other)

![image-20230502151851154](attachments/cs193x.assets/image-20230502151851154.png)

---

### Asynchronous Programming

![image-20230502152240231](attachments/cs193x.assets/image-20230502152240231.png)

* Javascript is written asynchronously. We don't make an event loop like below. Instead, we use event listeners and callbacks.
* We don't have any command to allow us to just wait for the next result.

![image-20230502152244645](attachments/cs193x.assets/image-20230502152244645.png)

* This is kind of what the browser does behind the hood. It just has an event loop for all of these event listeners.

---

### Promises

![image-20230502152250803](attachments/cs193x.assets/image-20230502152250803.png)

* A `Promise` is something that happens later. It's basically when there's a thing, and the promise just says when something happens, call me back to do something.

![image-20230502152301005](attachments/cs193x.assets/image-20230502152301005.png)

---

### Fetch API

![image-20230502153147976](attachments/cs193x.assets/image-20230502153147976.png)

* `fetch` can be used to get the contents from a URL. It will return a `Promise`.

#### fetch Example

* We have the following code in our `App.js` and the following webpage.

```js
export default class App {
  constructor() {
    this._onClick = this._onClick.bind(this);

    let button = document.querySelector("#button");
    button.addEventListener("click", this._onClick);
  }

  _onClick(event) {
    let result = fetch("myfile.txt");
    console.log(result);
  }
}

```

* Now, if I click the `Make request` button, we can see that it fetches it in our network.

![image-20230502153656818](attachments/cs193x.assets/image-20230502153656818.png)

* Notice that the `fetch` call returns a `Promise`. The `Promise` has a few things that we can access.
* We have to use `.then` to get something after the promise sttles.

```js
export default class App {
  constructor() {
    this._onClick = this._onClick.bind(this);

    let button = document.querySelector("#button");
    button.addEventListener("click", this._onClick);
  }

  _onClick(event) {
    // the result of fetch is a promise
    let promise = fetch("myfile.txt");
    // pass in a call back function to be 
    // called when the fetch completes
    promise.then((response) => {
      let promise2 = response.text()
      // another callback function for the text
      promise2.then((text) => {
        document.querySelector("#results").textContent = text;
      })
    })
  }
}
```

| ![image-20230502155625740](attachments/cs193x.assets/image-20230502155625740.png) | ![image-20230502155634570](attachments/cs193x.assets/image-20230502155634570.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

![image-20230502155839136](attachments/cs193x.assets/image-20230502155839136.png)

---

### JSON

* We can also use this to read in `json` files as objects.

```json
{
  "id": "michael",
  "givenName": "Michael",
  "surname": "Chang"
}

```

```js
export default class App {
  constructor() {
    this._onClick = this._onClick.bind(this);

    let button = document.querySelector("#button");
    button.addEventListener("click", this._onClick);
  }

  _onClick(event) {
    // text
    let promise = fetch("myfile.txt");
    promise.then((response) => {
      let promise2 = response.text()
      promise2.then((text) => {
        document.querySelector("#results").textContent = text;
      })
    })

    // json
    promise = fetch("person.json");
    promise.then((response) => {
      let promise2 = response.json()
      promise2.then((obj) => {
        let results = document.querySelector("#results");
        let s = `\n${obj.givenName} ${obj.surname}`
        results.textContent += s;
      })
    })
  }
}

```

![image-20230502160712810](attachments/cs193x.assets/image-20230502160712810.png)

* The issue with this is that not only is it messy, we also don't know which `Promise` will resolve first. If the `fetch` for the json file finishes before the text file, the json name will be shown before the text is shown.
* To fix this, we can do this:

```js
export default class App {
  constructor() {
    this._onClick = this._onClick.bind(this);

    let button = document.querySelector("#button");
    button.addEventListener("click", this._onClick);
  }

  _onClick(event) {
    // text
    let promise = fetch("myfile.txt");
    promise.then((response) => {
      let promise2 = response.text()
      promise2.then((text) => {
        // json
        let promise3 = fetch("person.json");
        promise3.then((response) => {
          let promise4 = response.json()
          promise4.then((obj) => {
            let results = document.querySelector("#results");
            let s = `${text}\n${obj.givenName} ${obj.surname}`
            results.textContent = s;
          })
        })
      })
    })
  }
}
```

* We essentially chain a bunch of promises and callback functions.

---

### Issues with Promises: Callback

![image-20230502155906384](attachments/cs193x.assets/image-20230502155906384.png)

---

### Async and await

![image-20230502161110497](attachments/cs193x.assets/image-20230502161110497.png)

* Putting the `async` method tells the user that the function also returns a `Promise`. It's not guaranteed to finish and return instantly. 

![image-20230502161115705](attachments/cs193x.assets/image-20230502161115705.png)

* The `await` essentially puts the function to sleep until the `promise` is settled, and then comes back and finishes the code.

* Using these, we can rewrite the function from above as:

```js
async _onClickBetter(event) {
  let res = await fetch("myfile.txt");
  let text = await res.text();

  let res2 = await fetch("person.json");
  let obj = await res2.json();

  let results = document.querySelector("#results");
  let s = `${text}\n${obj.givenName} ${obj.surname}`
  results.textContent = s;
}
```

* This achieves the same functionality, but the code is much cleaner.

![image-20230502161512109](attachments/cs193x.assets/image-20230502161512109.png)

---

#### Important Details

![image-20230502161542322](attachments/cs193x.assets/image-20230502161542322.png)

![image-20230502161546296](attachments/cs193x.assets/image-20230502161546296.png)

---

## 5/4 L10: Rest APIs

* Suppose that in the API directory, we have this javascript file.

```js
import bodyParser from "body-parser";
import express from "express";

const api = express.Router();
api.use(bodyParser.json());

api.use((req, res, next) => {
  console.log(`${req.method} ${req.originalUrl}`);
  next();
});

api.get("/", (req, res) => {
  res.json({ message: "Hello, world!", num: 193 });
});

api.get("/text", (req, res) => {
  res.send("Hello, world!");
});

const NAMES = [
  ["Michael", "Chang"], ["Neel", "Kishnani"], ["Kashif", "Nazir"]
];
const STUDENTS = Object.fromEntries(NAMES.map(([givenName, surname]) => {
  let id = (givenName[0] + surname).toLowerCase();
  return [id, { id, givenName, surname, dept: null, unitsCompleted: 0, isAlum: false }];
}));

api.get("/students", (req, res) => {
  let students = Object.values(STUDENTS);
  let query = req.query.filter;
  if (query) {
    query = query.toLowerCase();
    students = students.filter(s => `${s.givenName} ${s.surname}`.toLowerCase().includes(query));
  }
  res.json({ students: students.map(({ id, givenName, surname }) => ({ id, givenName, surname })) });
});

api.use("/students/:id", (req, res, next) => {
  let id = req.params.id;
  let student = STUDENTS[id];
  if (!student) {
    res.status(404).json({ error: `Can't find student ${id}` });
    return;
  }
  next();
});

api.get("/students/:id", (req, res) => {
  let student = STUDENTS[req.params.id];
  res.json(student);
});

api.patch("/students/:id", (req, res) => {
  let student = STUDENTS[req.params.id];
  if ("dept" in req.body) {
    if (student.dept && student.dept !== req.body.dept) {
      res.status(400).json({ error: `${student.id} already declared ${student.dept}` });
      return;
    }
    student.dept = req.body.dept.toUpperCase();
  }
  if ("unitsCompleted" in req.body) {
    student.unitsCompleted = req.body.unitsCompleted;
  }
  res.json(student);
});

api.get("/students/:id/courses", (req, res) => {
  res.json({ courses: [
    { code: "CS107", units: 5 }, { code: "CS193X", units: 3 }
  ] });
});

api.post("/students/:id/graduate", (req, res) => {
  let student = STUDENTS[req.params.id];
  if (student.isAlum) res.status(400).json({ error: `${student.id} already graduated` });
  else if (!student.dept) res.status(400).json({ error: `${student.id} hasn't declared yet` });
  else if (student.unitsCompleted < 180) res.status(400).json({ error: `${student.id} doesn't have enough units` });
  else {
    student.isAlum = true;
    res.json({ success: true });
  }
});

api.get("/protected", (req, res) => {
  res.status(403).json({ error: "You aren't allowed" });
});

export default (app) => {
  app.set("json spaces", 2);
  app.use("/api", api);
};

```

* We can access files directly through the API directory. Instead of trying to access the direct files, we essentially get it through the api.

```js
  async _onClickBetter(event) {
    let res = await fetch("/api/text");
    let text = await res.text();
    let res2 = await fetch("/api/students/mchang");
    let obj = await res2.json();
    let s = `${text}\n${obj.givenName} ${obj.surname}`;
    document.querySelector("#results").textContent = s;
  }
```

<img src="./cs193x.assets/image-20230504151638497.png" alt="image-20230504151638497" style="zoom:50%;" />

---

### REST APIs

![image-20230504151950130](attachments/cs193x.assets/image-20230504151950130.png)

* The above example is a REST API, where we get a resources. It defines rules that the API follows for users to use.
* The statelessness means that each request should work independently of other requests.

---

### Classes and REST APIs

![image-20230504152755653](attachments/cs193x.assets/image-20230504152755653.png)

![image-20230504152802654](attachments/cs193x.assets/image-20230504152802654.png)

* Suppose we want to assign the object from an API into a class.

```js
async _onClickBetter(event) {
  let res2 = await fetch("/api/students/mchang");
  let obj = await res2.json();
  let student = new Student(obj);
}
```

* There are two ways to do this:

```js
export default class Student {
  constructor(data) {
    this.id = data.id;
    this.givenName = data.givenName;
    this.surname = data.surname;
  }
}
```

```js
export default class Student {
  constructor(data) {
    Object.assign(this, data);
  }
}
```

#### Methods

* Now, with this class, we can make a few functions in the class to deal with the student data.

```js
export default class Student {
  constructor(data) {
    Object.assign(this, data);
    // the path that all data about this student is at
    this._uri = `/api/students/${this.id}`;
  }

  async listCourses() {
    let res = await fetch(`${this._uri}/courses`);
    let json = await res.json();
    return json.courses;
  }
}
```

```js
  async _onClickBetter(event) {
    let res2 = await fetch("/api/students/mchang");
    let obj = await res2.json();
    let student = new Student(obj);
    console.log(student);
    let courses = await student.listCourses();
    console.log(courses)
  }
```

![image-20230504153534354](attachments/cs193x.assets/image-20230504153534354.png)

---

* Note that constructors can't be async. As such, if we wanted our class to be the one to get our data from the API instead of the app, we'd have to make a method like this.

```js
export default class Student {
  // static function, not called on an individual student
  static async load(id) {
    let res = await fetch(`/api/students/${id}`);
    let obj = await res.json();
    return new Student(obj);
  }

  constructor(data) {
    Object.assign(this, data);
    // the path that all data about this student is at
    this._uri = `/api/students/${this.id}`;
  }

  async listCourses() {
    let res = await fetch(`${this._uri}/courses`);
    let json = await res.json();
    return json.courses;
  }
}
```

```js
  async _onClickBetter(event) {
    let s = await Student.load("mchang")
    console.log(s);
    let courses = await s.listCourses();
    console.log(courses);
  }
```

![image-20230504154203430](attachments/cs193x.assets/image-20230504154203430.png)

* Now, we've successfully moved all the logic inside the `Student` class. Note that the load method is called on the class itself (bc its static).

---

### HTTP Requests

![image-20230504155258747](attachments/cs193x.assets/image-20230504155258747.png)

![image-20230504155311570](attachments/cs193x.assets/image-20230504155311570.png)

![image-20230504155319752](attachments/cs193x.assets/image-20230504155319752.png)

---

![image-20230504155330795](attachments/cs193x.assets/image-20230504155330795.png)

![image-20230504155340551](attachments/cs193x.assets/image-20230504155340551.png)

---

![image-20230504155411151](attachments/cs193x.assets/image-20230504155411151.png)

![image-20230504155416784](attachments/cs193x.assets/image-20230504155416784.png)

![image-20230504155421218](attachments/cs193x.assets/image-20230504155421218.png)

![image-20230504155426145](attachments/cs193x.assets/image-20230504155426145.png)

---

### Sending data to server

* We can also send data to the server. Suppose we want to declare the major of a student.

```js
  async _onClickBetter(event) {
    let s = await Student.load("mchang")
    console.log(s);
    await s.declare("MATH");
    console.log(s);
  }
```

```js
  async declare(deptCode) {
    // create an object of the thing we want to change
    let body = { dept: deptCode };
    let res = await fetch(this._uri, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    // in this API, returns copy of updated student
    let data = await res.json();
    console.log(data);
  }
```

![image-20230504161820093](attachments/cs193x.assets/image-20230504161820093.png)

* Note that even though it changed it in the server, it didn't actually change the `s` object. To fix this, remember to update it.

```js
  async declare(deptCode) {
    // create an object of the thing we want to change
    let body = { dept: deptCode };
    let res = await fetch(this._uri, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    // in this API, returns copy of updated student
    let data = await res.json();
    this.depth = data.dept;
    console.log(data);
  }
```

![image-20230504161927680](attachments/cs193x.assets/image-20230504161927680.png)

---

### Exceptions

* Notice that the server can also give exceptions. Suppose we try to declare a student that has already declared.

```js
  async _onClickBetter(event) {
    let s = await Student.load("mchang")
    await s.declare("MATH");
    await s.declare("CS");
  }
```

![image-20230504162026346](attachments/cs193x.assets/image-20230504162026346.png)

* We can get the status and do error checking like this.

---

## 5/9 L11: More Rest APIs

### Sending data to server

![image-20230509150623668](attachments/cs193x.assets/image-20230509150623668.png)

![image-20230509150629685](attachments/cs193x.assets/image-20230509150629685.png)

---

### Students and App

* Here is the code for our Student class from last time.

```js
export default class Student {
  static async load(id) {
    let res = await fetch(`/api/students/${id}`);
    let data = await res.json();
    return new Student(data);
  }

  constructor(data) {
    /* Copy all key/values from data and put them in this */
    Object.assign(this, data);

    this._uri = `/api/students/${this.id}`;
  }

  async listCourses() {
    let res = await fetch(`${this._uri}/courses`);
    let json = await res.json();
    return json.courses;
  }

  async declare(dept) {
    let body = { dept: dept };
    // update the department in the API
    await this._update(body);
  }

  async _update(body) {
    let res = await fetch(this._uri, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    let data = await res.json();
    if (res.status !== 200) {
      throw new Error(data.error);
    }
    // update all the instance variables with new values from the server
    Object.assign(this, data);
  }
}
```

* This class will be getting data from the API as well as modifying it. Notice that we use `async` and `await`.
* `PATCH` in the `declare` method is used to update the resource in the API.

#### Loading Data

* We can use the app to load data from the API.

```js
export default class App {
  constructor() {
    // binds all the event handlers
    this._onLoad = this._onLoad.bind(this);

    // notice that everything is private
    let b = document.querySelector("#load");
    b.addEventListener("click", this._onLoad);

    // used to store the current student
    this._student = null;
  }

  async _onLoad(event) {
    // use prompt to get user input
    let id = prompt("Student ID:");
    // load the student using the static async method
    let s = await Student.load(id);
    this._student = s;
    this._showStudent();
  }
    
  _showStudent() {
    let s = this._student;
    if (!s) {
      this._setResults("No student loaded");
      return;
    }
    let str = `ID: ${s.id}\nName: ${s.givenName} ${s.surname}\nDept: ${s.dept}\nUnits: ${s.unitsCompleted}\nAlum? `;
    str += s.isAlum ? "Yes" : "No";
    this._setResults(str);
  }

  _setResults(text) {
    document.querySelector("#results").textContent = text;
  }
}
```

* Remember that `.load` loads the API and returns an instance of the Student class.

![image-20230509151610687](attachments/cs193x.assets/image-20230509151610687.png)

* Now we implement the update function, which allows us to update information.
  * Note that the App is in charge of the DOM, not the Student class.

```js
  async _onUpdate() {
    await this._student.declare("CS");
    this._showStudent();
  }
```

![image-20230509151837820](attachments/cs193x.assets/image-20230509151837820.png)

* Note that server remembers the data that we update. It'll only reset when we reset the server.
  * If we refresh the page and load it again, it will still show that the department is CS.

* If I reset the server (ie. end the console and run `npm start` again), then the data is reset to its original value.

![image-20230509152043894](attachments/cs193x.assets/image-20230509152043894.png)

---

#### Exception Checking

* Note that in our code, if we try to load a bad student ID, it still tries to load it. This leads to the undefined.

```js
  static async load(id) {
    let res = await fetch(`/api/students/${id}`);
    let data = await res.json();
    return new Student(data);
  }
```

![image-20230509152618490](attachments/cs193x.assets/image-20230509152618490.png)

![image-20230509152623468](attachments/cs193x.assets/image-20230509152623468.png)

* In the above, we tried to load a student with the id `binky`, which does not exist. The code doesn't check this, and just creates the student anyways.

```js
  static async load(id) {
    let res = await fetch(`/api/students/${id}`);
    let data = await res.json();
    if (res.status === 200) {
      // success case
      return new Student(data);
    }
    // error case with the data's error code
    throw new Error(data.error);
  }
```

* Now with the code above, it doesn't show undefined on the screen. Instead, it just simply throws an error.

![image-20230509152838803](attachments/cs193x.assets/image-20230509152838803.png)

* We can add a try catch to our app now to show this error to the user.

```js
  async _onLoad(event) {
    // use prompt to get user input
    let id = prompt("Student ID:");
    try {
      let s = await Student.load(id);
      this._student = s;
      this._showStudent();
    } catch(e) {
      this._setResults(e.message);
    }
  }
```

* Now it shows the error message when there's an error.

![image-20230509153012450](attachments/cs193x.assets/image-20230509153012450.png)

---

### API Documentation

* Below is an example of an API documentation. This is for the student API used above.
* An endpoint is also known as a route. Basically the ending location of a call to the API.

```
GET /
-----
Test endpoint. Always returns the same thing.

GET /students
-------------
Query string:
  q (optional): search string
Return a list of students, optionally whose names contain the search string.

GET /students/:id
-----------------
Parameters:
  id: student ID
Errors
  404: id doesn't match a student in the system
Return the student object with the given ID.

GET /students/:id/courses
-----------------
Parameters:
  id: student ID
Errors
  404: id doesn't match a student in the system
Return a list of courses the student has taken

PATCH /students/:id
-------------------
Parameters:
  id: student ID
Reuqest body:
  An Object with keys dept and unitsCompleted, both optional.
  dept can either be the department name or code
Update the student with the given ID. Properties not included in the request body are unchanged. (Properties not listed above cannot be changed.)
Returns the updated student object, in the same format as `GET /students/:id`.

POST /students/:id/graduate
-------------------------
Parameters:
  id: student ID
Errors:
  400: Student isn't declared or doesn't have enough units
Graduate a student (mark them as an alum), if the student is declared and has enough units.
On success, returns the object `{ "success": true }`.
```

---

### Modifying API

* We have the following to declare a major.

```js
  async declare(dept) {
    let body = { dept: dept };
    // update the department in the API
    await this._update(body);
  }

  async _update(body) {
    let res = await fetch(this._uri, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    let data = await res.json();
    if (res.status !== 200) {
      throw new Error(data.error);
    }
    // update all the instance variables with new values from the server
    Object.assign(this, data);
  }
```

* Notice that update has an error throw, but declare doesn't have a try catch. As such, we need to implement this error catching.

```js
  async _onUpdate() {
    try {
      await this._student.declare("CS");
      this._showStudent();
    } catch(e) {
      this._setResults(e.message);
    }
  }
```

* The code above is doing error catchign in the app.
* With the fact that update is decomposed, we can also use it to update other properties.

```js
  async addUnits(units) {
    let body = { unitsCompleted: this.unitsCompleted + units };
    // update the units completed in the API
    await this._update(body);
  }
```

```js
  async _onUpdate() {
    try {
      await this._student.declare("CS");
      await this._student.addUnits(200);
      this._showStudent();
    } catch(e) {
      this._setResults(e.message);
    }
  }
```

![image-20230509155921437](attachments/cs193x.assets/image-20230509155921437.png)

![image-20230509155843866](attachments/cs193x.assets/image-20230509155843866.png)

---

### Graduate

* We now implement the graduate method, which removes the student and sets them as an alum once they reach a certain point.
* We first have to make the handler function in the Student class.

```js
  async graduate() {
    // we use POST because we want to take action on something
    let res = await fetch(`${this._uri}/graduate`, {
      method: "POST"
    });
    let data = await res.json();
    console.log(data);
    if (res.status !== 200) {
      throw new Error(data.error);
    }
    /* Reload the student to update instance variables */
    // we need to use fetch bc the data from POST isn't useful
    let res2 = await fetch(this._uri);
    let data2 = await res2.json();
    Object.assign(this, data2);
  }
```

* Then we make the handler for the button in the App class.

```js
  async _onGraduate() {
    try {
      await this._student.graduate();
      this._showStudent();
    } catch (e) {
      this._setResults(e.message);
    }
  }
```

![image-20230509160923904](attachments/cs193x.assets/image-20230509160923904.png)

* Notice that the `console.log` just prints out `success: true`. This means that's all the data returns.

* Now we can graduate the current student!
* Note that if I try to graduate the student again, I'll catch an error that shows on the screen.

![image-20230509160817885](attachments/cs193x.assets/image-20230509160817885.png)

---

### List Students

* Suppose we now want to list all the students in our system.
* Since we don't have a specific student, we need a function that is `static` that can be used on the `Student` class.

---

## 5/11 L12: Node

### Definitions

![image-20230511151026568](attachments/cs193x.assets/image-20230511151026568.png)

* The `HTTP` provides us with a language/syntax to allow us to connect with the server

### Web servers

![image-20230511151535426](attachments/cs193x.assets/image-20230511151535426.png)

* Web servers can be written in any language. Unlike with the webpage where you must write in JS/TS, you can write in python, C, etc.

### NodeJS

![image-20230511151729633](attachments/cs193x.assets/image-20230511151729633.png)

* NodeJS is a program that interprets the JS language, just like how Chrome interprets the JS language.
* The engine is basically just a JS interpreter. What we don't have from the Chrome engine is the libraries (e.g. `document`, `window`, queryselectors, event listeners, etc)
  * These functions are specific to how JavaScript works in the browser.
* Node gives us a way to interpret these libraries. Tell us how to start a server, read/write files, etc.

#### Node Console

* We can use the node console in the terminal just like the chrome javascript console.

![image-20230511152644148](attachments/cs193x.assets/image-20230511152644148.png)

#### Running script files

* We create a file, and we'll run it with node.

```js
// File: text.js

import fs from "fs/promises"; // import a node.js library

const main = async () => {
  // read the text file and print it out
  let text = await fs.readFile("myfile.txt", "utf8");
  console.log(text);
};
main();
```

![image-20230511153152011](attachments/cs193x.assets/image-20230511153152011.png)

* Notice the use of `await` and `sync` for the file reading. This is because reading the file may take a while.

#### Basics Summary

![image-20230511153258841](attachments/cs193x.assets/image-20230511153258841.png)

* **Best practice**: if you want to do testing with Node, don't use the REPL. Just make a test file and run it there.

### Building a webserver with HTTP

* We can build a http web server using the `http` package, which is included in Node.

![image-20230511154024707](attachments/cs193x.assets/image-20230511154024707.png)

![image-20230511154028994](attachments/cs193x.assets/image-20230511154028994.png)

* The equivalent to `addEventListener` for Node is the `.on` function

```js
// this is a build in package in Node
import http from "http";

// create a HTTP web server
let server = http.createServer();

// the request gives two arguments
const handleRequest = (req, res) => {
  console.log(`${req.method} ${req.url}`);
  // set the header so that it shows
  res.setHeader("Content-Type", "text/plain");
  // end the request
  res.end("Hello from a Node server!");
};
server.on("request", handleRequest);

// tell the server to start listening to a certain port
// the command returns immediately, but server keeps running
server.listen(1930,  () => {
  // callback provided, call it when we start listening
  console.log("Listening on port 1930");
});

// note that with the above, it's just listening. It doesn't
// know what to do
```

![image-20230511154333883](attachments/cs193x.assets/image-20230511154333883.png)

![image-20230511154306984](attachments/cs193x.assets/image-20230511154306984.png)

* Note that if we don't have the `res.end`, no response is ever sent, so it just loads the page infinitely.

---

### External Modules - NPM

![image-20230511155143596](attachments/cs193x.assets/image-20230511155143596.png)

* This allows us to install other modules, to make our life easier.
* When you run `npm install` with no arguments, it will go into `package.json` and install whatever is under the `dependencies` section.
* You can also manually install it by specifying a package.

* This is how `package.json` looks originally

  ![image-20230511155316324](attachments/cs193x.assets/image-20230511155316324.png)

* Now, we will install Express, which is a webserver library. I do this by running `npm install express` in the terminal.

* This is what `package.json` looks like afterwards.

  ![image-20230511155400666](attachments/cs193x.assets/image-20230511155400666.png)

---

### Express

* Now, we can make a webserver using Express instead of `http`.

![image-20230511155451559](attachments/cs193x.assets/image-20230511155451559.png)

* Here is how we create a webserver using express.

```js
// File: server.js
import express from "express";

// create an express web app
let app = express();
app.listen(1930, () => {
  console.log("Now listening on port 1930");
});
```

![image-20230511155703835](attachments/cs193x.assets/image-20230511155703835.png)

---

#### Routes/Endpoints

* Instead of `server.on` like before, we can use routes.

```js
// File: server.js
import express from "express";

// create an express web app
let app = express();

app.get("/", (req, res) => {
  res.send("Hello from Express");
});

app.listen(1930, () => {
  console.log("Now listening on port 1930");
});
```

* With the `app.get` line above, when the user access the `/` directory, that request is sent.

![image-20230511155651030](attachments/cs193x.assets/image-20230511155651030.png)

![image-20230511155721273](attachments/cs193x.assets/image-20230511155721273.png)

* app.all, app.post, app.patch, app.get, app.use, etc

* We can extend this further by adding more routes.

```js
// File: server.js
import express from "express";

// create an express web app
let app = express();

app.get("/", (req, res) => {
  res.send("Hello from Express");
});

app.get("/binky", (req, res) => {
  res.send("Hello this is binky!");
});

app.listen(1930, () => {
  console.log("Now listening on port 1930");
});
```

![image-20230511155803352](attachments/cs193x.assets/image-20230511155803352.png)

### Serving static files

* We can have express look into a folder (e.g. the `public` folder), and serve all the files inside it into the web server.
* To do it, we use the `.static` function. Note that it returns a function.

```js
// File: server.js
import express from "express";

// create an express web app
let app = express();

console.log(express.static("public"));

app.listen(1930, () => {
  console.log("Now listening on port 1930");
});
```

![image-20230511160124206](attachments/cs193x.assets/image-20230511160124206.png)

* We can now use `app.use` to have it call some function when a route is reached.

```js
// File: server.js
import express from "express";

// create an express web app
let app = express();


app.use("/files", express.static("public"));

app.listen(1930, () => {
  console.log("Now listening on port 1930");
});
```

* Note that the public folder has two files:

![image-20230511160243383](attachments/cs193x.assets/image-20230511160243383.png)



```html
<!-- File: index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Lecture 12</title>
  </head>
  <body>
    <p>This file is being served by Express.</p>
  </body>
</html>
```

```
// File: myfile.txt
Here's a text file
```

* Now, if I go to `localhost:1930/files`, it will serve the `index.html` file.

![image-20230511160355801](attachments/cs193x.assets/image-20230511160355801.png)

* If I go further into the `myfiles.txt`, I'll get the text file.

![image-20230511160420079](attachments/cs193x.assets/image-20230511160420079.png)

* If I pass nothing for the first parameter in `app.use`, it will interpret that as putting it into `/`. This means when I go to `localhost:1930`, it will show `index.html`.

```js
// File: server.js
import express from "express";

// create an express web app
let app = express();

app.get("/", (req, res) => {
  res.send("Hello from Express");
});

app.get("/binky", (req, res) => {
res.send("Hello this is binky!");
});

/* serves files from public under localhost:1930/files */
//app.use("/files", express.static("public"));

/* serves files in public from the route */
app.use(express.static("public"));

app.listen(1930, () => {
  console.log("Now listening on port 1930");
});
```

![image-20230511160536542](attachments/cs193x.assets/image-20230511160536542.png)

![image-20230511160546095](attachments/cs193x.assets/image-20230511160546095.png)

* Note that now there is a conflict at `/`. We have the first route saying `"Hello from Express"`, and we also have `index.html`.
  * Express will serve whichever one goes first in the code.

#### Recap

![image-20230511160914863](attachments/cs193x.assets/image-20230511160914863.png)

---

### APIs

* We can use this route thing to serve APIs.

```js
app.get("/api/test", (req, res) => {
  res.json({ text: "Hello", num: 193})
});
```

![image-20230511160841982](attachments/cs193x.assets/image-20230511160841982.png)

* Note that the `.json` here is different from before.
  * When we called it from the browser/client side, it essentially says the server gives us a `json` object, and we want to turn it into a JavaScript object.
  * When we call it from the server now, it essentially tells it to turn the JavaScript object that we pass in as a parameter into a `json` object.

#### Route parameters

* We can pass in parameters using express. Putting the colon in front of the `uri` sets it as a parameter.

```js
app.get("/api/student/:binky", (req, res) => {
  let studentID = req.params.binky;
  console.log(studentID);
  // res.json({message: `Hello ${studentID}!`});
  res.send(`Hello ${studentID}!`);
});
```

* To access the params, note that it uses `req.params`.

![image-20230511161629558](attachments/cs193x.assets/image-20230511161629558.png)

---

![image-20230511161044991](attachments/cs193x.assets/image-20230511161044991.png)

#### REST APIs in Express

![image-20230511161053134](attachments/cs193x.assets/image-20230511161053134.png)

---

### Errors

* When there is an error, the browser will still show the thing. You have to look at your terminal to see the error.
* Suppose I have the code below. Notice that `foobar` doesn't exist.

```js
app.get("/api/student/:binky", (req, res) => {
  let studentID = req.params.binky;
  console.log(foobar);
  res.send(`Hello ${studentID}!`);
});
```

![image-20230511161907689](attachments/cs193x.assets/image-20230511161907689.png)

---

![image-20230511161737523](attachments/cs193x.assets/image-20230511161737523.png)

---

### Automatic Reloading

* There's a package called `nodemon`. This allows the page to automatically reload every time you change any file. That way, you don't have to restart the server.

![image-20230511162015627](attachments/cs193x.assets/image-20230511162015627.png)

* Now, we can add it to the `script` part of `packing.json` to have it run when we start.

![image-20230511162043366](attachments/cs193x.assets/image-20230511162043366.png)

![image-20230511162107203](attachments/cs193x.assets/image-20230511162107203.png)

---

## 5/16 L13: Node API backends

* In today's lecture, we implement the backend (server/API) for the Student class that we used previously.
* As a reference, here is the code for student.

```js
export default class Student {
  static async list(search) {
    let res = await fetch(`/api/students?q=${search}`);
    let data = await res.json();
    return data;
  }

  static async load(id) {
    let res = await fetch(`/api/students/${id}`);
    let data = await res.json();
    if (res.status === 200) {
      return new Student(data);
    }
    throw new Error(data.error);
  }

  constructor(data) {
    /* Copy all key/values from data and put them in this */
    Object.assign(this, data);

    this._uri = `/api/students/${this.id}`;
  }

  async listCourses() {
    let res = await fetch(`${this._uri}/courses`);
    let json = await res.json();
    return json.courses;
  }

  async enroll(code, units) {
    let res = await fetch(`${this._uri}/courses`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ code: code, units: units })
    });
    let data = await res.json();
    if (res.status !== 200) {
      throw new Error(data.error);
    }
    
    /* Reload the student to update instance variables */
    let res2 = await fetch(this._uri);
    let data2 = await res2.json();
    Object.assign(this, data2);
  }

  async update(body) {
    let res = await fetch(this._uri, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    let data = await res.json();
    if (res.status !== 200) {
      throw new Error(data.error);
    }
    Object.assign(this, data);
  }
}
```

---

### Routing

* To do the routing, we can add the following line into our `server.js`

```js
const app = express();

app.get("/api/students", (req, res) => {
  blah blah blah
});
```

* However, the convention is to put these routes inside a file called `index.js`, which is located in the `api` folder.

```js
// Filename: api/index.js

/* create our data as objects, basically the database */
const NAMES = [
  ["Michael", "Chang"], ["Neel", "Kishnani"]
];
const STUDENTS = {};
const COURSES = {};
for (let [givenName, surname] of NAMES) {
  let id = (givenName[0] + surname).toLowerCase();
  STUDENTS[id] = { id, givenName, surname, dept: null, units: 0 };
  COURSES[id] = [];
}
// note that these objects do not persist when server is restarted

/* create a function to make the init route for the app */
const initApi = (app) => {
  // stuff goes here
};
export default initApi; // export the function
```

* We then import this function from `server.js` and call it in the main function.

```js
import initApi from "./api/index.js";

const main = async () => {
  initApi(app);
  server.listen(PORT, () => {
    console.log(`Server started. Now open http://localhost:${PORT}/ in your browser.`);
  });
};
main();
```

---

### initApi

* We don't really want to set a route for every single thing in the API. Instead, we can use `app.use` to serve the entire api.
* We can create a `Router`, and build all the routes from there. Then, from the API, we just simply server that router when the `/api` directory is reached.

```js
/* create a function to make the init route for the app */
let myApi = express.Router();
myApi.get("/", (req, res) => {
  res.json({ message: "Hello, word!" });
});

const initApi = (app) => {
  app.use("/api", myApi);
};
export default initApi; // export the function
```

![image-20230516154001867](attachments/cs193x.assets/image-20230516154001867.png)

---

### Students

* We can get a list of all students using this. To do so, we just access the `STUDENTS` object which we created.

```js
/* create a function to make the init route for the app */
let myApi = express.Router();
myApi.get("/", (req, res) => {
  res.json({ message: "Hello, word!" });
});

myApi.get("/students", (req, res) => {
  let students = Object.values(STUDENTS);
  res.json({students});
})

const initApi = (app) => {
  app.use("/api", myApi);
};
export default initApi; // export the function
```

![image-20230516153925820](attachments/cs193x.assets/image-20230516153925820.png)

---

### Debugging

* To debug whether an API is correct, you can check the network tab.

![image-20230516155030599](attachments/cs193x.assets/image-20230516155030599.png)

* You can look at the response to see what the API returned to check if it's correct.

---

### Query string

* In order to allow the user to pass a query string, use `req.query`

* The query string is the `?q=...`

```js
myApi.get("/students", (req, res) => {
  let students = Object.values(STUDENTS);
  // get the query string
  let search = req.query.q;
  if (search) {
    // if the query string is not empty
    students = []
    for (let student of Object.values(STUDENTS)) {
      if (student.id.includes(search)) {
        students.push(student);
      }
    }
  }
  res.json({students});
})
```

* Now if I query for `m`, it will only return the ones that includes `m`

![image-20230516155724597](attachments/cs193x.assets/image-20230516155724597.png)

---

### Getting a specific student

```js
myApi.get("/students/:sunet", (req, res) => {
  let id = req.params.sunet;
  let student = STUDENTS[id]
  if (!student) {
    // if the student is null, return not found status code

    /* regular syntax */
    // res.status(404);
    // res.json({ error: "Unknown student"});
    /* chaining syntax */
    res.status(404).json({ error: "Unknown student"});
    return;
  }
  res.json(student);
});
```

---

### Middleware

* Notice that we need to get the specific student a lot if we wanted to update or changing a student.
* We can unify this code by changing the `get` from the previous one to `use`.
* Then, for the rest of the functions going to the same path, we can just refer to the local variables saved by the middleware.

```js
/* Middleware: everything under :id, we want to handle in similar way */
myApi.use("/students/:id", (req, res, next) => {
  let id = req.params.id;
  let student = STUDENTS[id]
  if (!student) {
    res.status(404).json({ error: "Unknown student"});
    return;
  }
  // at this point, the student object is looked up
  /* Store the student so the handler can get it */
  // local variable for this specific request
  res.locals.student = student;
  /* Keep going and call the handler */
  next()
});

myApi.get("/students/:id", (req, res) => {
  let student = res.locals.student;
  res.json(student);
});
```

![image-20230516161301547](attachments/cs193x.assets/image-20230516161301547.png)

![image-20230516161307772](attachments/cs193x.assets/image-20230516161307772.png)

---

### Modifying the API

* To modify data, we can use the `.patch`

```js
myApi.patch("/students/:id", (req, res) => {
  let student = res.locals.student;
  student.dept = ...;
  res.json(student);
});
```

#### Reading request body

* However, now we need to read the body of the request.
* To do so, use the `body-parser` package.

```js
import bodyParser from "body-parser";

/* create a function to make the init route for the app */
let myApi = express.Router();
/* Interpret request body as JSON and store them in req.body */
myApi.use(bodyParser.json());
```

```js
myApi.patch("/students/:id", (req, res) => {
  let student = res.locals.student;
  student.dept = req.body.dept;
  res.json(student);
});
```

![image-20230516161622118](attachments/cs193x.assets/image-20230516161622118.png)

---

### API design tips

![image-20230516161719722](attachments/cs193x.assets/image-20230516161719722.png)

![image-20230516161747680](attachments/cs193x.assets/image-20230516161747680.png)

* `POST` can be used to enroll, to graduate ,etc

![image-20230516161925428](attachments/cs193x.assets/image-20230516161925428.png)

---

## 5/18 L14: Databases and MongoDB

* Databases are a way to store information about stuff.
* Allows you to perform CRUD operations
  * Create, retrieve, update, and delete

### SQL databases

![image-20230518150711832](attachments/cs193x.assets/image-20230518150711832.png)

* SQL is also sometimes called a relational database.
* The tables can relate to each other. In this case, the `advisorid` field in the `students` table relates to the `id` field in the `advisors` table

### NoSQL

![image-20230518150748842](attachments/cs193x.assets/image-20230518150748842.png)

* Instead of tables, the data is stored as documents/objects
  * Think it it basically like a key/value pair
* It's kind of like a tree/graph

---

### MongoDB

![image-20230518151638683](attachments/cs193x.assets/image-20230518151638683.png)

---

### mongosh shell

![image-20230518151721641](attachments/cs193x.assets/image-20230518151721641.png)

![image-20230518151726236](attachments/cs193x.assets/image-20230518151726236.png)

#### collection operations

![image-20230518151743784](attachments/cs193x.assets/image-20230518151743784.png)





---

### _id

![image-20230518153722419](attachments/cs193x.assets/image-20230518153722419.png)

---

### Creating a Collection

![image-20230518154205202](attachments/cs193x.assets/image-20230518154205202.png)

![image-20230518154329331](attachments/cs193x.assets/image-20230518154329331.png)

### insertMany

![image-20230518154446543](attachments/cs193x.assets/image-20230518154446543.png)

![image-20230518154459370](attachments/cs193x.assets/image-20230518154459370.png)

![image-20230518154506928](attachments/cs193x.assets/image-20230518154506928.png)

### Query Operators

![image-20230518154540808](attachments/cs193x.assets/image-20230518154540808.png)

![image-20230518154531276](attachments/cs193x.assets/image-20230518154531276.png)

![image-20230518155117321](attachments/cs193x.assets/image-20230518155117321.png)

### Replace

![image-20230518155349432](attachments/cs193x.assets/image-20230518155349432.png)

![image-20230518155517121](attachments/cs193x.assets/image-20230518155517121.png)

### Update

![image-20230518155529607](attachments/cs193x.assets/image-20230518155529607.png)

![image-20230518155452831](attachments/cs193x.assets/image-20230518155452831.png)

### Delete

![image-20230518155525285](attachments/cs193x.assets/image-20230518155525285.png)

![image-20230518155537750](attachments/cs193x.assets/image-20230518155537750.png)

![image-20230518155604322](attachments/cs193x.assets/image-20230518155604322.png)

![image-20230518155609433](attachments/cs193x.assets/image-20230518155609433.png)

---

### mongoDB in Node

![image-20230518155901861](attachments/cs193x.assets/image-20230518155901861.png)

#### Connecting to MongoDB

![image-20230518155953162](attachments/cs193x.assets/image-20230518155953162.png)

![image-20230518160843661](attachments/cs193x.assets/image-20230518160843661.png)

![image-20230518160859292](attachments/cs193x.assets/image-20230518160859292.png)

```js
import { MongoClient } from "mongodb";

const main = async () => {
  // 127.0.0.1 is localhost
  let conn = await MongoClient.connect("mongodb://127.0.0.1");
  // this is not async because databases are created on first use
  let db = conn.db("example");
  let myColl = db.collection("myCollection");
  await myColl.insertOne({ binky: "winky", num: 193 });
  
  // the await for this is for toArray, not the .find part
  let docs = await myColl.find({ num: 193 }).toArray();
  console.log(docs);
};
main();
```

![image-20230518160828789](attachments/cs193x.assets/image-20230518160828789.png)

---

### Converting Students to DB

* We convert the lecture code from before to use the database instead of the api

* Below is how it was originally

```js
const NAMES = [
  ["Michael", "Chang"], ["Neel", "Kishnani"], ["Kashif", "Nazir"]
];
const STUDENTS = {};
const COURSES = {};
for (let [givenName, surname] of NAMES) {
  let id = (givenName[0] + surname).toLowerCase();
  STUDENTS[id] = { id, givenName, surname, dept: null, units: 0 };
  COURSES[id] = [];
}

let myApi = express.Router();
const initApi = (app) => {
  app.use("/api", myApi);
};

```

* This is what it is with the database

```js
const DATABASE_NAME = "lect14_db";

let myApi = express.Router();
// make global variables so other functions can access the collections
let Students;
let Enrollments;
const initApi = async (app) => {
  app.use("/api", myApi);

  let conn = await MongoClient.connect("mongodb://127.0.0.1");
  let db = conn.db(DATABASE_NAME);

  Students = db.collection("students");
  Enrollments = db.collection("enrollments");
};
```

---

#### Listing Functions

* This is how the code is originally. Notice that it accesses the `STUDENTS` object directly.

```js
myApi.get("/students", (req, res) => {
  let students = Object.values(STUDENTS);
  let search = req.query.q;
  if (search) {
    students = [];
    for (let student of Object.values(STUDENTS)) {
      /* Check if the query is contained in each student's name */
      let name = `${student.givenName} ${student.surname}`.toLowerCase();
      if (name.includes(search.toLowerCase())) students.push(student);
    }
  }
  res.json({ students });
});
```

* Now, we use the database and query features to get access to all the students.

```js
myApi.get("/students", async (req, res) => {
  // get all the entries the Students collection
  let allStudents = await Students.find().toArray();
  let search = req.query.q;
  let students = allStudents;
  if (search) {
    // if we have a search, build the students array
    students = [];
    for (let student of allStudents) {
      /* Check if the query is contained in each student's name */
      let name = `${student.givenName} ${student.surname}`.toLowerCase();
      if (name.includes(search.toLowerCase())) {
        students.push(student);
      }
    }
  }
  // now remove the _id field that was automatically created
  for (let so of students) delete search._id;
  res.json({ students });
});
```

---

#### Middleware

* This is original code

```js
myApi.use("/students/:id", (req, res, next) => {
  let id = req.params.id;
  let student = STUDENTS[id];
  if (!student) {
    res.status(404).json({ error: "Unknown student" });
    return;
  }
  /* Store the student so the handler can get it */
  res.locals.student = student;
  /* "Keep going": call the handler */
  next();
});
```

* This is database code

```js
myApi.use("/students/:id", async (req, res, next) => {
  let id = req.params.id;
  let student = await Students.findOne({ id: id });
  if (!student) {
    res.status(404).json({ error: "Unknown student" });
    return;
  }
  /* Store the student so the handler can get it */
  res.locals.student = student;
  /* "Keep going": call the handler */
  next();
});

myApi.get("/students/:id", (req, res) => {
  let student = res.locals.student;
  res.json(student);
});
```

---

#### Updating Department (Patch)

* This is original

```js
myApi.patch("/students/:id", (req, res) => {
  let student = res.locals.student;
  student.dept = req.body.dept;
  res.json(student);
});
```

* This is database

```js
myApi.patch("/students/:id", async (req, res) => {
  let student = res.locals.student;
  student.dept = req.body.dept;
  // replace the db student with the updated one
  await Students.replaceOne({ id: student.id }, student);
  res.json(student);
});
```

---

#### Looking up a student's courses

* This was the original code

```js
myApi.get("/students/:id/courses", (req, res) => {
  let student = res.locals.student;
  let courses = COURSES[student.id];
  res.json({ courses: courses });
});
```

* This is the database version
  * We can find the courses of a student by looking at the enrollments database.

```js
myApi.get("/students/:id/courses", async (req, res) => {
  let student = res.locals.student;
  let data = await Enrollments.find({ studentId: student.id }).toArray();
  let courses = [];
  for (let doc of data) {
    courses.push({ code: doc.code, units: doc.units });
  }
  res.json({ courses });
});
```

## 5/23 L15: App Organization

### Route Ordering

![image-20230523150900425](attachments/cs193x.assets/image-20230523150900425.png)

* You should make the `.get` go above the `.all`, since after calling `api.all("/*")`, no other api routes will be called.

---

### Web app structure

![image-20230523151241858](attachments/cs193x.assets/image-20230523151241858.png)

#### Single page application

* There is only one HTML file in the application, and the JavaScript manages the HTML to add and change things.
* The JS will show and hide elements, create and delete elements, fetching data, etc
* An example of an SPA is assignment 3.1
  * We just modified the HTML through our JavaScript for the different pages. We never actually generated new HTML pages.

---

### Browser URL bar

![image-20230523151851074](attachments/cs193x.assets/image-20230523151851074.png)

* So far, the browser URLs are pointing to specific files. 

#### Limitations

* No dynamic URLs and shareable links.
  * You can't go to `profile/mchang` to see `mchang` profile.
  * This would mean every user would have their own HTML file in `public`

* No deep links
  * With an SPA, the back button doesn't work. You can't go to a previous URL since it is all updated on the spot at the same link.
  * In assignment 3.1, you couldn't hit the back button to go back to the login screen.

---

### Multi-step approach

![image-20230523152232000](attachments/cs193x.assets/image-20230523152232000.png)

* For step 0, if it's not something that matters, just point directly to HTML file.

### Step 0.5: URL Hash

#### Frontend: Location

* This is step 0.5. It's basically a front-end only modification. The server won't reload.

* `window.location` is a frontend command that allows us to get information about the link in the URL bar.

![image-20230523152530531](attachments/cs193x.assets/image-20230523152530531.png)

* Everything up to the query search string gets sent to the server. However, the hash part doesn't.
* This gives us a lightweight way of interacting with our URL and the frontend, without interaction with the server at all.

![image-20230523152931998](attachments/cs193x.assets/image-20230523152931998.png)

![image-20230523152936687](attachments/cs193x.assets/image-20230523152936687.png)

![image-20230523152940590](attachments/cs193x.assets/image-20230523152940590.png)

```js
const loadProfile = () => {
  // updates the page to show the current link
  document.querySelector("#location").textContent = window.location.href;

  let title = document.querySelector("h1");
  // get the hash from url bar
  let hash = window.location.hash;
  if (hash.length > 1) {
    // change the frontend based on the hash
    title.textContent = `${hash.slice(1)}'s Profile`;
  } else {
    title.textContent = "Home";
  }
};

const main = () => {
  loadProfile();
  window.addEventListener("hashchange", loadProfile);
};
main();
```

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>URL hash | Lecture 15</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="hash.js"></script>
  </head>
  <body>
    <h1>Home</h1>
    <!-- The link gets edited into this paragraph -->
    <p>Location: <span id="location"></span></p>
    <ul>
       <!-- Redirect the page tp hahshes when the links are clicked -->
      <li><a href="#">Home</a></li>
      <li><a href="#Michael">Michael's Profile</a></li>
      <li><a href="#Neel">Neel's Profile</a></li>
    </ul>
  </body>
</html>
```

* Note that when you click the links, it changes the URL bar and the frontend, but it doesn't actually navigate anywhere or reload anything.

![image-20230523153228952](attachments/cs193x.assets/image-20230523153228952.png)

* This can be seen with the above, where the console only says `Navigated to` once even though I was clicking through all of the links.

#### Hash Change Handler

* There exists an event listener for when the hash changes
* `window.addEventListener("hashchange", loadProfile);`
* This calls the handler every time we navigate to a new hash

#### Default Hash Handler

* The default handler for the hash is to look through the document for something with the ID, and scroll the page to focus on that element.
* This is kinda like how you can scroll on the docs

![image-20230523154001070](attachments/cs193x.assets/image-20230523154001070.png)

---

### Step 1: Managing the URL

* In this case, we have actual URLs that direct us to pages.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Home | Lecture 15</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="home.js"></script>
  </head>
  <body>
    <h1>Home</h1>
    <p>Location: <span id="location"></span></p>
    <ul>
      <li><a href="/home.html">Home</a></li>
      <li><a href="/profile/Michael">Michael's Profile</a></li>
      <li><a href="/profile/Neel">Neel's Profile</a></li>
    </ul>
    <p><a href="#" id="histLink">History API</a></p>
  </body>
</html>
```

![image-20230523154607758](attachments/cs193x.assets/image-20230523154607758.png)

* Now, clicking on the links `Michael's Profile` and `Neel's Profile` still takes us to their profiles, but the URL actually changes to those.

![image-20230523154636494](attachments/cs193x.assets/image-20230523154636494.png)

* This works because we have the following in `server.js`

```js
app.get("/profile/:id", (req, res) => {
  res.sendFile("profile.html", { root: publicPath });
});
```

* This basically sends the file `profile.html` from the `public` folder.
* This sends the file to be displayed on the page.

#### Backend: sending files

![image-20230523154939509](attachments/cs193x.assets/image-20230523154939509.png)

#### profile.html

* Notice that it sends the file to be served on the page at `profile/id`.
* However, we also need to modify the page to show the username. To do this, it uses `window.location` to retrieve the URL and set the username.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Profile | Lecture 15</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="/profile.js"></script>
  </head>
  <body>
    <h1><span id="user"></span>'s Profile</h1>
    <p>Location: <span id="location"></span></p>
    <ul>
      <li><a href="/home.html">Home</a></li>
      <li><a href="/profile/Michael">Michael's Profile</a></li>
      <li><a href="/profile/Neel">Neel's Profile</a></li>
    </ul>
  </body>
</html>
```

```js
const loadProfile = () => {
  document.querySelector("#location").textContent = window.location.href;

  let userText = document.querySelector("#user");
  let path = window.location.pathname;
  let username = path.slice(path.lastIndexOf("/") + 1);
  userText.textContent = username;
};

const main = () => {
  loadProfile();
};
main();
```

* The difference between `location.pathname` and `location.href` is that `pathname` only gives the path, not the entire link

![image-20230523155324482](attachments/cs193x.assets/image-20230523155324482.png)

---

### History API

![image-20230523160337571](attachments/cs193x.assets/image-20230523160337571.png)

![image-20230523160341855](attachments/cs193x.assets/image-20230523160341855.png)

```js
const updateLocation = () => {
  document.querySelector("#location").textContent = window.location.href;
};

// event handler for when the `History API` linked is clicked
const onLink = (event) => {
  event.preventDefault();
  window.history.pushState(null, "", "/binky");
  updateLocation();
};

const onPop = (event) => {
  document.querySelector("h1").textContent = "Popstate";
  updateLocation();
};

const main = () => {
  updateLocation();

  document.querySelector("#histLink").addEventListener("click", onLink);
  window.addEventListener("popstate", onPop);
};
main();
```

#### onLink

* When the History API link is clicked, the page doesn't get reloaded; it just changes the URL to `http://localhost:1930/binky`

![image-20230523160515422](attachments/cs193x.assets/image-20230523160515422.png)

![image-20230523160520655](attachments/cs193x.assets/image-20230523160520655.png)

#### onPop

* This occurs when the user presses the backwards and forwards button.

![image-20230523160706105](attachments/cs193x.assets/image-20230523160706105.png)

---

### Session storage

![image-20230523160802646](attachments/cs193x.assets/image-20230523160802646.png)

* Suppose we have this original page `storage.html`

![image-20230523160923731](attachments/cs193x.assets/image-20230523160923731.png)

* This page stores the session using sessionStorage

```js
const onSubmit = (event) => {
  event.preventDefault();
  let id = event.currentTarget.userid.value;
  // stores the user id
  window.sessionStorage.setItem("user", id);
  // redirects to another page (reload the page and server)
  window.location.assign("storage_profile.html");
};

const main = () => {
  document.querySelector("#loginForm").addEventListener("submit", onSubmit);
};
main();
```

![image-20230523161204583](attachments/cs193x.assets/image-20230523161204583.png)

* Now in the other `storage_profile.html` page, we need to access the user `id` that was passed into the form.

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>sessionStorage Profile | Lecture 15</title>

    <!-- This line provides automatic page and style reloading when files change -->
    <script type="module" src="/lib/client/updater.js"></script>

    <script type="module" src="storage_profile.js"></script>
  </head>
  <body>
    <h1><span id="user"></span>'s Profile</h1>
    <button id="logout">Log out</button>
  </body>
</html>

```

![image-20230523161150937](attachments/cs193x.assets/image-20230523161150937.png)

* Notice that it knows the name that was logged in. This works because it access the sessionStorage.

```js
const onLogout = (event) => {
  window.sessionStorage.removeItem("user");
  window.location.replace("storage.html");
};

const main = () => {
  let user = window.sessionStorage.getItem("user");
  document.querySelector("#user").textContent = user;
  document.querySelector("#logout").addEventListener("click", onLogout);
};
main();
```

---

## 5/25 L16: Authentication

### Definitions

* Authentication (authn) - verify the user's identity
  * The Stanford ID Card is the authentication
* Authorization (auhtz) - determine if the user is allowed to do the thing
  * Whether you're able to access certain buildings is the authorization

### Authenticating to an API

![image-20230525151104390](attachments/cs193x.assets/image-20230525151104390.png)

* One way to authenticate is with an API key
  * Think of it like a password. The server gives you a token, and you remember it. Then, to access your data, you give the server that token.

### Sending API keys

* There are two main ways to send an API key to the API.
  * The first way is to send it as a query string
  * The second way is to pass it as an HTTP header

![image-20230525151625463](attachments/cs193x.assets/image-20230525151625463.png)

* Just look at the documentation of the API to see how you're supposed to send the key.

### Handling User Login

![image-20230525151750797](attachments/cs193x.assets/image-20230525151750797.png)

---

### Unhashed Passwords

* One way that you might think of logging in is to send the email and password in the header of the request.
* The issue with this is that if someone gets access to this password, they have the pure password itself. They can then use this to access other sites (assuming the user reuses a lot of passwords).
* This would also mean if someone tried to use the API through code, they would have to store their password in the code itself.
* This issue also occurs if someone gets access to the database. We don't want them to have access to all of the passwords.

#### Salted, Hashed Passwords

![image-20230525154046800](attachments/cs193x.assets/image-20230525154046800.png)

![image-20230525154051054](attachments/cs193x.assets/image-20230525154051054.png)

* When someone logs in, you don't care what the passwords are. You just care that the hashes are the same.

![image-20230525154909135](attachments/cs193x.assets/image-20230525154909135.png)

* Notice that the hashed password is deterministic. Giving it the same password gives the same hashed password.

![image-20230525160153948](attachments/cs193x.assets/image-20230525160153948.png)

* The salted password is the password that is actually stored in the database. This is also deterministic -- giving the same salt and password gives the same password
  * Password salting is a technique to protect passwords stored in databases by adding a string of 32 or more characters and then hashing them. Salting prevents hackers who breach an enterprise environment from reverse-engineering passwords and stealing them from the database.

![image-20230525155722349](attachments/cs193x.assets/image-20230525155722349.png)

* The salts are also stored in the database for each password.

![image-20230525160200618](attachments/cs193x.assets/image-20230525160200618.png)

![image-20230525160209335](attachments/cs193x.assets/image-20230525160209335.png)

### API keys with JWTs

![image-20230525160224491](attachments/cs193x.assets/image-20230525160224491.png)

![image-20230525160420696](attachments/cs193x.assets/image-20230525160420696.png)

### Manual Login

```js
let API_KEY = null;

const onLogin = async (event) => {
  event.preventDefault();
  // load the email and password
  let email = document.querySelector("#email").value;
  let password = document.querySelector("#password").value;
  // fetch from the server for the result
  let opts = {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  };
  let res = await fetch("/api/login", opts);
  let json = await res.json();
  if (res.status === 200) {
    // login succeeded
    document.querySelector("#loginForm").style.display = "none";
    console.log(json);
    // save the apiKey for the user
    API_KEY = json.apiKey;
  } else {
    alert(json.error);
  }
};

const onProtected = async (event) => {
  let res = await fetch("/api/protected", {
    headers: { "Authorization": `Bearer ${API_KEY}` }
  });
  let json = await res.json();
  if (res.status !== 200) {
    alert(json.error);
  } else {
    alert(json.message);
  }
};

const main = () => {
  document.querySelector("#loginForm").addEventListener("submit", onLogin);
  document.querySelector("#protected").addEventListener("click", onProtected);
};
main();
```

* Note that the API key is not random. If it was, we would have to store it in the database.

---

### Third-party Authentication

![image-20230525160917352](attachments/cs193x.assets/image-20230525160917352.png)

![image-20230525160925633](attachments/cs193x.assets/image-20230525160925633.png)

#### Security Tips

![image-20230525160952133](attachments/cs193x.assets/image-20230525160952133.png)

![image-20230525161531565](attachments/cs193x.assets/image-20230525161531565.png)

---

## 5/30 L17: Mobile pages and CSS tricks

### Mobile Behavior

![image-20230530150449497](attachments/cs193x.assets/image-20230530150449497.png)

* Phone screens are fundamentally smaller than computer screens.

### Media queries

![image-20230530151023941](attachments/cs193x.assets/image-20230530151023941.png)

### Mobile friendly CSS

![image-20230530151127234](attachments/cs193x.assets/image-20230530151127234.png)

### CSS animation

![image-20230530151133022](attachments/cs193x.assets/image-20230530151133022.png)

### CSS transitions

![image-20230530151140233](attachments/cs193x.assets/image-20230530151140233.png)

### CSS transform

![image-20230530151202246](attachments/cs193x.assets/image-20230530151202246.png)

### Pointer events

![image-20230530151213139](attachments/cs193x.assets/image-20230530151213139.png)

![image-20230530151216531](attachments/cs193x.assets/image-20230530151216531.png)

![image-20230530151219821](attachments/cs193x.assets/image-20230530151219821.png)

### External fonts and icons

![image-20230530151226254](attachments/cs193x.assets/image-20230530151226254.png)

![image-20230530151236270](attachments/cs193x.assets/image-20230530151236270.png)

