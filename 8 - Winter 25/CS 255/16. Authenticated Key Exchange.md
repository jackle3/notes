# Review: Key Exchange
All the key exchange protocols so far have only been secure against passive adversaries (eavesdroppers).
![[Pasted image 20250310132426.png]]

# Active Adversary
Active adversaries has complete control of the network:
* Can modify, inject, or delete packets/messages from the network (e.g. man-in-the-middle attacks)
* They can also be **corrupt users** controlled by the adversary
	* Goal: key exchange with corrupt users does not affect other sessions
![[Pasted image 20250310132631.png]]
**Problem**: this cannot be solved by just using regular key exchange ⟶ can always have a MITM attack if the two parties cannot authenticate each other

## Trusted Third Party
**All AKE protocols** require a **TTP** to certify user identities
![[Pasted image 20250310132826.png]]

## AKE Syntax
At the end of the AKE protocol, each party has a shared key and know **who** they are communicating with
* Each party has a **secret key** and a **certificate** that they got from the TTP (e.g. CA)
* They can verify the certificate of the other party using the public key of the TTP
* When Alice sends $E(k, \text{"Data"})$, she has a guarantee that only the receiver can read the data
![[Pasted image 20250310132928.png]]

# Basic AKE Security
From Alice's perspective, there are three main goals of the AKE security (**static security**):
1. No one else can know the shared secret $k$ except for the bank
2. Even if adversaries know Alice's other shared keys, $k$ is indistinguishable from a random string
3. If Alice obtains $(k, \text{Bank})$, then Bank must obtain $(k, \text{Alice})$
![[Pasted image 20250310133316.png]]

## AKE Security Levels
1. **Static Security**: same as the goals above
2. **Forward Secrecy**: static security + if the $sk_\text{bank}$ is compromised, previous sessions are not affected
3. **HSM Security**: forward secrecy + interacting $n$ times with the HSM (device that stores keys) compromises at most $n$ sessions
![[Pasted image 20250310133555.png]]

# Protocol 1: Static Security
## One-sided AKE
One side is a verifier (only has $vk_\text{CA}$) while the other is a prover (has secret key, cert, and $vk_\text{CA}$)
* Used when only **one side** has a certificate ⟶ during key exchange, only Bank authenticates itself to Alice
* Usually followed with some identification protocol so that Alice can authenticate itself with Bank
![[Pasted image 20250310134202.png]]
Note that **this is how the web works**:
* When you connect to Amazon, you are the verifier and Amazon is the prover
* During the key exchange (TLS), you know that you are talking to Amazon but Amazon does not know who you are
* Afterwards, you log in to Amazon (identification protocol) ⟶ now both know each other's identity

## Building Blocks
![[Pasted image 20250310134344.png]]

## 1. Simple One-sided AKE
1. Bank sends Alice a random nonce $r$ and its certificate $\text{cert}_\text{bank}$ (which contains $\text{pk}_\text{bank}$)
2. Alice chooses a random shared key $k$ and replies with $E(\text{pk}_\text{bank}, (k, r))$
![[Pasted image 20250310134649.png]]

### Insecure Variant: Replay Attack
Notice that the nonce $r$ is **replied under encryption**. If it was instead **sent in the clear**, the protocol would be vulnerable to replay attacks.
![[Pasted image 20250310135050.png]]
When $r$ is not encrypted with the key, the ciphertext $c$ is only dependent on $k$ and not $r$
* An adversary can replay the same ciphertext $c$ with a new $r'$ and reuse the key
* This allows the adversary to replay $c_1$ and all other messages that was sent before with this key
![[Pasted image 20250310135121.png]]

## 2. Two-sided AKE
1. Bank sends Alice a random nonce $r$ and its certificate $\text{cert}_\text{bank}$ (which contains $\text{pk}_\text{bank}$)
2. Alice chooses a random shared key $k$ and replies with two things:
	* $c \leftarrow E_\text{bank}((k, \text{"alice"}))$: to send her own identity to Bank
	* $\sigma \leftarrow \text{Sign}_\text{Alice}((r, c, \text{"bank"}))$ and $\text{cert}_\text{alice}$: to prove to the bank that her identity is authentic
![[Pasted image 20250310135428.png]]

### Insecure Variant: Identity Misbinding
